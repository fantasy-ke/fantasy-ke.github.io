<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>gRPC in ASP.NET Core | Fantasy`Ke Blog</title><meta name="keywords" content="ASP.NET Core,gRPC"><meta name="author" content="Fantasy-ke"><meta name="copyright" content="Fantasy-ke"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="gRPC in ASP.NET Core"><meta name="application-name" content="gRPC in ASP.NET Core"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="gRPC in ASP.NET Core"><meta property="og:url" content="https://blog.fantasyke.cn/posts/896e333f.html"><meta property="og:site_name" content="Fantasy`Ke Blog"><meta property="og:description" content="消息类型的演进 在.NET Core中使用gRPC 多项目之间共享&amp;#96;proto&amp;#96;文件"><meta property="og:locale" content="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><meta property="og:image" content="https://filebed.fantasyke.cn/file/wallpaper/748a31364d194d419020419f204265f0.6wqtgcnicr.webp?_r_=d77abe90-8ef1-ef20-f1a5-b3e5ba352c86"><meta property="article:author" content="Fantasy-ke"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://filebed.fantasyke.cn/file/wallpaper/748a31364d194d419020419f204265f0.6wqtgcnicr.webp?_r_=d77abe90-8ef1-ef20-f1a5-b3e5ba352c86"><meta name="description" content="消息类型的演进 在.NET Core中使用gRPC 多项目之间共享&amp;#96;proto&amp;#96;文件"><link rel="shortcut icon" href="https://filebed.fantasyke.cn/file/logo/favicon.ico"><link rel="canonical" href="https://blog.fantasyke.cn/posts/896e333f.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//www.clarity.ms"><meta name="google-site-verification" content="0qBBGdG7vYORyT5XLZRUqQZ_y5kKYhgyUwNqjSIImg0"><meta name="algolia-site-verification" content="4C7825663F86ADB3"><meta name="baidu-site-verification" content="codeva-P64BkuHkDm"><meta name="msvalidate.01" content="63C90D0EC3DA6C31FD109132B7BEF502"><script async defer src="https://umami.fantasyke.cn/script.js" data-website-id="b57cd87f-e343-49ac-b443-6f8f4f309f84"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload='this.media="all"'><script async src="https://www.googletagmanager.com/gtag/js?id=G-5N1WS0B6FJ"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-5N1WS0B6FJ")</script><script>!function(e,t,c,n,a,r,s){e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},(r=t.createElement(n)).async=1,r.src="https://www.clarity.ms/tag/qfb52xcecl",(s=t.getElementsByTagName(n)[0]).parentNode.insertBefore(r,s)}(window,document,"clarity","script")</script><script>const GLOBAL_CONFIG={linkPageTop:{enable:!0,title:"与数百名博主无限进步",addFriendPlaceholder:"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"Fantasy",mode:"fantasy",switchBtn:!1,btnLink:"https://afdian.net/item/886a79d4db6711eda42a52540025c377",randomNum:3,basicWordCount:1e3,key:"xxxx",Referer:"https://xx.xx/"},diytitle:{enable:!0,leaveTitle:"(∪.∪ )...zzz",backTitle:"♪(´▽｀)"},LA51:void 0,greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 宝贝",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.fantasyke.cn",commentBarrageConfig:{enable:!0,maxBarrage:1,barrageTime:8e3,accessToken:"0ca6db2a330bbffcb0d254a061dbd00e",mailMd5:"F6CBE561768BA13B8E01135BF4767C8D"},music_page_default:"nav_music",root:"/",preloader:{source:3},friends_vue_info:void 0,navMusic:!0,mainTone:void 0,authorStatus:{skills:["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},algolia:{appId:"G44M1T5X02",apiKey:"417e6420e5de4c61138e56634ac44fa0",indexName:"fantasy_blog",hits:{per_page:6},languages:{input_placeholder:"输入关键词后按下回车查找",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"它已经",messageNext:"自上次更新以来的天数，文章的内容可能已过时。"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!1,limitCount:50,languages:{author:"作者: Fantasy-ke",link:"链接: ",source:"来源: Fantasy`Ke Blog",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,shortcutKey:{enable:!0,delay:100,shiftDelay:200},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"Fantasy`Ke Blog",title:"gRPC in ASP.NET Core",postAI:"true",pageFillDescription:"开发环境, VSCode, 消息类型的演进, 更新消息类型的规则, 默认值, 枚举, 在.NET Core中使用gRPC, ASP.NET Core, .NET Core, 引包之后的操作, 作为服务端, 作为客户端, 上代码, 服务端, 创建目录, 编写proto, 编写测试数据, 编写Service, 修改Startup, 运行项目, 客户端, 创建项目, 复制proto文件, 修改Program.cs, 运行项目, 日志和异常, 日志, ASP.NET Core, .NET Core控制台, 异常, 关于JWT授权, 多项目之间共享proto文件开发环境下需要安装百度找去官网自行下载如果下载速度慢可以添加以下内容到文件然后再中安装两个插件消息类型的演进向前兼容变更使用新的文件来写数据从旧的文件读取数据向后兼容变更使用旧的文件来写数据从新的文件读取数据更新消息类型的规则不要修改任何现有字段的数字可以添加新的字段旧的代码会忽略掉新字段的解析所以要注意新字段的默认值字段可以被删除只要它们的数字在更新后的消息类型中不再使用即可也可以把字段名使用前缀而不是删除字段或者把这些字段的数字进行保留以免未来其他开发者不小心使用这些字段尽量不要修改原有的字符数据类型默认值默认值在更新消息定义的时候有很重要的作用它可以防止对现有代码新代码造成破坏性影响它们也可以保证字段永远不会有值但是默认值还是非常危险的你无法区分这个默认值到底是来自一个丢失的字段还是字段的实际值正好等于默认值所以需要保证这个默认值对于业务来说是一个毫无意义的值例如人口这个字段的默认值可以设置为再就是可能需要再代码里对默认值进行判断处理枚举同样可以进化就和消息的字段一样可以添加删除值也可以保留值但是如果代码不知道它接收到的值对应哪个值那么的默认值将会被采用在中使用依赖包依赖包引包之后的操作按照项目类型引入上面的包之后直接编译是不会得到框架生成的代码需要做以下操作右键文件属性将选择为按照需求选择进行完上面的操作之后编译项目会在目录里自动生成代码作为服务端怎么实现定义的方法假设在文件里有这样一个在编译项目之后会有一个的类自己编写一个类继承自这个类然后去重载服务里定义的那些方法即可作为客户端怎么调用定义的方法需要先创建例如然后假设在文件里有这样一个在编译项目之后需要选择或会有一个的类实例化这个类就相当实例化一个例如在里就可以调用服务里定义的那些方法上代码服务端创建名字为的项目类型为空通过引入创建目录在项目根目录创建以下三个文件夹编写在文件夹中添加文件具体内容如下在解决方案资源管理器找到文件右键属性选择选择编译一次项目编写测试数据在文件夹创建文件内容如下黑色灰色广东省深圳市南山区微服务实战本广东省深圳市南山区注意这里的是生成的命名空间为编写在文件夹创建文件内容如下有人请求接口订单号错误有人请求接口发送数据有人请求接口有人请求接口接受数据注意这里的一样是生成的命名空间为修改修改内容如下运行项目在中进入到项目根目录直接运行目录即可客户端创建项目创建名字为的控制台应用通过引入以下三个包复制文件将服务端的文件夹拷贝到项目根目录在解决方案资源管理器找到文件右键属性选择选择修改修改文件内容如下接收到数据接收到数据数据接收完毕蓝色广东省深圳市南山区北科大厦接收到数据蓝色广东省深圳市南山区北科大厦黑色白色广东省深圳市南山区北科大厦数据发送完毕接收到消息运行项目在进入到项目根目录使用运行项目既可以看到效果是对应里的参数日志和异常日志作为服务端在中开启日志只需要在中配置的日志等级即可修改内容如下运行项目就可以看到控制台打印出相关日志控制台在客户端的控制台程序需要自定义一个然后在创建的时候指定自定义的这里的示例使用来作为日志组件需要在引入以下三个包创建内容如下回到服务调用的地方将创建的代码修改如下运行项目即可以看到日志内容异常服务端在抛出异常的时候可以抛出来指定异常类型示例里的是一个可以携带自定义的键值对客户端捕获异常也可以捕获指定的一样可以拿到来获取自定义的键值对信息关于授权在通过授权接口获取到之后与普通请求类似也是放在头部与请求一起发送出去只不过在换了个名词编程其实是一样道理用来进行发送即可多项目之间共享文件使用单独的仓库管理文件使用将文件集成到工程目录中使用命令行添加文件及祥光依赖包引用备注由生成的代码文件会存放在目录中不会被嵌入到仓库",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-06-28 21:36:00",postMainColor:""}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{if(0===a)return;const o={value:t,expiry:Date.now()+864e5*a};localStorage.setItem(e,JSON.stringify(o))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const a=JSON.parse(t);if(!(Date.now()>a.expiry))return a.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise(((a,o)=>{const c=document.createElement("script");c.src=e,c.async=!0,c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},Object.keys(t).forEach((e=>{c.setAttribute(e,t[e])})),document.head.appendChild(c)})),e.getCSS=(e,t=!1)=>new Promise(((a,o)=>{const c=document.createElement("link");c.rel="stylesheet",c.href=e,t&&(c.id=t),c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},document.head.appendChild(c)})),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};const t=saveToLocal.get("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,o=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!a&&!o&&!c;if(void 0===t){if(o)activateLightMode();else if(a)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=6||e>=18?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener((e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())}))}else"light"===t?activateLightMode():activateDarkMode();const d=saveToLocal.get("aside-status");void 0!==d&&("hide"===d?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/static/main-style.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/mainColor/heoMainColor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/poem.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/static/images/avatar.png"><div class="loading-image-dot"></div></div></div><script>const preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",(()=>{preloader.endLoading()})),setTimeout((function(){preloader.endLoading()}),1e4),document.addEventListener("pjax:send",(()=>{preloader.initLoading()})),document.addEventListener("pjax:complete",(()=>{preloader.endLoading()}))</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://fantasyke.cn/" title="主页"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="主页"><span class="back-menu-item-text">主页</span></a><a class="back-menu-item" href="https://blog.fantasyke.cn/" title="博客"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://filebed.fantasyke.cn/" title="图床"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="图床"><span class="back-menu-item-text">图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://hot.fantasyke.cn/" title="今日热榜"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="今日热榜"><span class="back-menu-item-text">今日热榜</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://music.fantasyke.cn/" title="音乐"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="音乐"><span class="back-menu-item-text">音乐</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://status.fantasyke.cn/" title="站点状态"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="站点状态"><span class="back-menu-item-text">站点状态</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Fantasy`Ke Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET={CONFIG:{modules:"0124",background:"2",tmpColor:"FFFFFF",tmpSize:"16",cityColor:"FFFFFF",citySize:"16",aqiColor:"E8D87B",aqiSize:"16",weatherIconSize:"24",alertIconSize:"18",padding:"10px 10px 10px 10px",shadow:"0",language:"auto",borderRadius:"20",fixed:"true",vertical:"top",horizontal:"left",left:"20",top:"7.1",key:"df245676fb434a0691ead1c63341cd94"}}</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i> <span>时光卷轴</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i> <span>文章分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i> <span>文章标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa-solid fa-chart-pie faa-tada"></i> <span>文章通览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>社交</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i> <span>友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i> <span>留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa-solid fa-comments faa-tada faa-tada"></i> <span>评论</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i> <span>音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i> <span>碎碎念</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/sitenav/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>网站</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i> <span>关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/policy/"><i class="fa-solid fa-copyright faa-tada faa-tada"></i> <span>隐私策</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.fantasyke.cn"><i class="fa-solid fa-chart-simple faa-tada"></i> <span>站点统计</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i> <span>搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://filebed.fantasyke.cn/file/commonlyUsed/qrcode/qrcode-weichat.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/commonlyUsed/qrcode/qrcode-weichat.jpg"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://filebed.fantasyke.cn/file/commonlyUsed/qrcode/qrcode-alipay.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/commonlyUsed/qrcode/qrcode-alipay.jpg"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/NET-Core/" style="font-size:1.05rem">.NET Core<sup>3</sup></a><a href="/tags/ASP-NET-Core/" style="font-size:1.05rem">ASP.NET Core<sup>4</sup></a><a href="/tags/C/" style="font-size:1.05rem">C#<sup>12</sup></a><a href="/tags/CAP/" style="font-size:1.05rem">CAP<sup>1</sup></a><a href="/tags/CQRS/" style="font-size:1.05rem">CQRS<sup>1</sup></a><a href="/tags/DDD/" style="font-size:1.05rem">DDD<sup>1</sup></a><a href="/tags/Docker/" style="font-size:1.05rem">Docker<sup>10</sup></a><a href="/tags/Docker-Swarm/" style="font-size:1.05rem">Docker-Swarm<sup>2</sup></a><a href="/tags/EntityFramework-Core/" style="font-size:1.05rem">EntityFramework Core<sup>1</sup></a><a href="/tags/Git/" style="font-size:1.05rem">Git<sup>1</sup></a><a href="/tags/JWT/" style="font-size:1.05rem">JWT<sup>1</sup></a><a href="/tags/MediatR/" style="font-size:1.05rem">MediatR<sup>1</sup></a><a href="/tags/Middleware/" style="font-size:1.05rem">Middleware<sup>1</sup></a><a href="/tags/MongoDB/" style="font-size:1.05rem">MongoDB<sup>1</sup></a><a href="/tags/Mysql/" style="font-size:1.05rem">Mysql<sup>1</sup></a><a href="/tags/NOSQL/" style="font-size:1.05rem">NOSQL<sup>4</sup></a><a href="/tags/ORM/" style="font-size:1.05rem">ORM<sup>1</sup></a><a href="/tags/RabbitMQ/" style="font-size:1.05rem">RabbitMQ<sup>3</sup></a><a href="/tags/Redis/" style="font-size:1.05rem">Redis<sup>4</sup></a><a href="/tags/SQL-Server/" style="font-size:1.05rem">SQL Server<sup>1</sup></a><a href="/tags/Ubuntu/" style="font-size:1.05rem">Ubuntu<sup>1</sup></a><a href="/tags/docker/" style="font-size:1.05rem">docker<sup>1</sup></a><a href="/tags/gRPC/" style="font-size:1.05rem">gRPC<sup>1</sup></a><a href="/tags/gitlab/" style="font-size:1.05rem">gitlab<sup>1</sup></a><a href="/tags/hexo/" style="font-size:1.05rem">hexo<sup>1</sup></a><a href="/tags/life/" style="font-size:1.05rem">life<sup>1</sup></a><a href="/tags/nginx/" style="font-size:1.05rem">nginx<sup>1</sup></a><a href="/tags/notion/" style="font-size:1.05rem">notion<sup>2</sup></a><a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size:1.05rem">事务<sup>1</sup></a><a href="/tags/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/" style="font-size:1.05rem">人生感悟<sup>1</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size:1.05rem">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size:1.05rem">并发编程<sup>2</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E6%96%B9%E6%A1%88/" style="font-size:1.05rem">开发方案<sup>2</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size:1.05rem">消息队列<sup>3</sup></a><a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size:1.05rem">版本控制<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/" style="font-size:1.05rem">编程思想<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size:1.05rem">网络配置<sup>2</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size:1.05rem">设计模式<sup>25</sup></a><a href="/tags/%E9%80%9A%E8%AE%AF/" style="font-size:1.05rem">通讯<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size:1.05rem">面试题<sup>4</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"><i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E7%A0%96/" itemprop="url">杂七杂八的砖</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/ASP-NET-Core/" tabindex="-1" itemprop="url"><span><i class="anzhiyufont anzhiyu-icon-hashtag"></i> ASP.NET Core</span></a><a class="article-meta__tags" href="/tags/gRPC/" tabindex="-1" itemprop="url"><span><i class="anzhiyufont anzhiyu-icon-hashtag"></i> gRPC</span></a></span></div></div><h1 class="post-title" itemprop="name headline">gRPC in ASP.NET Core</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-06-28T21:36:00.000Z" title="发表于 2023-06-28 21:36:00">2023-06-28</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-06-28T21:36:00.000Z" title="更新于 2023-06-28 21:36:00">2023-06-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">3.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-position" title="作者IP属地为广州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i> 广州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://filebed.fantasyke.cn/file/wallpaper/748a31364d194d419020419f204265f0.6wqtgcnicr.webp?_r_=d77abe90-8ef1-ef20-f1a5-b3e5ba352c86"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">FantasyGPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://blog.fantasyke.cn/posts/896e333f.html"><header><a class="post-meta-categories" href="/categories/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E7%A0%96/" itemprop="url">杂七杂八的砖</a><a href="/tags/ASP-NET-Core/" tabindex="-1" itemprop="url">ASP.NET Core</a><a href="/tags/gRPC/" tabindex="-1" itemprop="url">gRPC</a><h1 id="CrawlerTitle" itemprop="name headline">gRPC in ASP.NET Core</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Fantasy-ke</span><time itemprop="dateCreated datePublished" datetime="2023-06-28T21:36:00.000Z" title="发表于 2023-06-28 21:36:00">2023-06-28</time><time itemprop="dateCreated datePublished" datetime="2023-06-28T21:36:00.000Z" title="更新于 2023-06-28 21:36:00">2023-06-28</time></header><h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><h2 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h2><p>window下需要安装<code>Clang</code>，百度找<code>Clang</code>，去官网自行下载，如果下载速度慢，可以添加以下内容到<code>C:\Windows\System32\drivers\etc\host</code>文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">54.231.82.146 vagrantcloud-files-production.s3.amazonaws.com  </span><br><span class="line">219.76.4.4 s3.amazonaws.com  </span><br><span class="line">219.76.4.4 github-cloud.s3.amazonaws.com  </span><br></pre></td></tr></table></figure><p>然后再<code>VSCode</code>中安装两个插件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vscode-proto3  </span><br><span class="line">Clang-Format  </span><br></pre></td></tr></table></figure><h1 id="消息类型的演进"><a href="#消息类型的演进" class="headerlink" title="消息类型的演进"></a>消息类型的演进</h1><ul><li><p>向前兼容变更：使用新的<code>.proto</code>文件来写数据 – 从旧的<code>.proto</code>文件读取数据</p></li><li><p>向后兼容变更：使用旧的<code>.proto</code>文件来写数据 – 从新的<code>.proto</code>文件读取数据</p><h2 id="更新消息类型的规则"><a href="#更新消息类型的规则" class="headerlink" title="更新消息类型的规则"></a>更新消息类型的规则</h2></li><li><p>不要修改任何现有字段的数字(tag)</p></li><li><p>可以添加新的字段，旧的代码会忽略掉新字段的解析，所以要注意新字段的默认值</p></li><li><p>字段可以被删除，只要它们的数字<code>(tag)</code>在更新后的消息类型中不再使用即可，也可以把字段名使用<code>OBSOLETE_</code>前缀而不是删除字段，或者把这些字段的数字<code>(tag)</code>进行保留<code>(reserved)</code>，以免未来其他开发者不小心使用这些字段</p></li><li><p>尽量不要修改原有的字符数据类型</p><h2 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h2><p>默认值在更新<code>Protocol Buffer</code>消息定义的时候有很重要的作用，它可以防止对现有代码&#x2F;新代码造成破坏性影响。它们也可以保证字段永远不会有<code>null</code>值</p></li></ul><p>但是，默认值还是非常危险的：<strong>你无法区分这个默认值到底是来自一个丢失的字段还是字段的实际值正好等于默认值</strong></p><p>所以，需要保证这个默认值对于业务来说是一个毫无意义的值，例如<code>int32 pop</code>人口这个字段的默认值可以设置为<code>-1</code>，再就是可能需要再代码里对默认值进行判断处理</p><h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h2><p><code>enum</code>同样可以进化，就和消息的字段一样，可以添加、删除值，也可以保留值</p><p>但是如果代码不知道它接收到的值对应哪个<code>enum</code>值，那么<code>enum</code>的默认值将会被采用</p><h1 id="在-NET-Core中使用gRPC"><a href="#在-NET-Core中使用gRPC" class="headerlink" title="在.NET Core中使用gRPC"></a>在<code>.NET Core</code>中使用<code>gRPC</code></h1><h2 id="ASP-NET-Core"><a href="#ASP-NET-Core" class="headerlink" title="ASP.NET Core"></a><code>ASP.NET Core</code></h2><p>依赖包：</p><p><code>Grpc.AspNetCore</code></p><h2 id="NET-Core"><a href="#NET-Core" class="headerlink" title=".NET Core"></a><code>.NET Core</code></h2><p>依赖包：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Google.Protobuf  </span><br><span class="line">Grpc.Net.Client  </span><br><span class="line">Grpc.Tools  </span><br></pre></td></tr></table></figure><h2 id="引包之后的操作"><a href="#引包之后的操作" class="headerlink" title="引包之后的操作"></a>引包之后的操作</h2><p>按照项目类型引入上面的包之后，直接编译是不会得到<code>gRPC</code>框架生成的代码，需要做以下操作：<br>右键.proto文件 -&gt; 属性 -&gt; 将<code>Build Action</code>选择为<code>Protobuf compiler</code> -&gt; <code>gRPC Stub Classes</code>按照需求选择<code>Client and Server/Client only/Server only/Do not generate</code></p><p>进行完上面的操作之后，编译项目会在<code>obj\Debug\netcoreapp3.1</code>目录里自动生成<code>RPC</code>代码</p><h2 id="作为服务端"><a href="#作为服务端" class="headerlink" title="作为服务端"></a>作为服务端</h2><p>怎么实现<code>rpc</code>定义的方法：假设在<code>.proto</code>文件里有<code>EmployeeService</code>这样一个<code>service</code>，在编译项目之后，会有一个<code>EmployeeService.EmployeeServiceBase</code>的类，自己编写一个类继承自<code>EmployeeService.EmployeeServiceBase</code>这个类，然后<code>override</code>去重载<code>.proto</code>服务里定义的那些<code>rpc</code>方法即可</p><h2 id="作为客户端"><a href="#作为客户端" class="headerlink" title="作为客户端"></a>作为客户端</h2><p>怎么调用<code>rpc</code>定义的方法：需要先创建<code>Channel</code>，例如：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> channel = GrpcChannel.ForAddress(<span class="string">&quot;https://localhost:5001&quot;</span>);  </span><br></pre></td></tr></table></figure><p>然后假设在<code>.proto</code>文件里有<code>EmployeeService</code>这样一个<code>service</code>，在编译项目之后(需要选择client或client and server)，会有一个<code>EmployeeService.EmployeeServiceClient</code>的类，实例化这个类就相当实例化一个<code>client</code>，例如：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> EmployeeService.EmployeeServiceClient(channel);  </span><br></pre></td></tr></table></figure><p>在<code>client</code>里就可以调用<code>.proto</code>服务里定义的那些方法</p><h1 id="上代码"><a href="#上代码" class="headerlink" title="上代码"></a>上代码</h1><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><p>创建名字为<code>RoutingDemo</code>的<code>ASP.NET Core</code>项目，类型为<code>空</code>，通过<code>nuget</code>引入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Grpc.AspNetCore  </span><br></pre></td></tr></table></figure><h3 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h3><p>在项目根目录创建以下三个文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Data  </span><br><span class="line">Protos  </span><br><span class="line">Services  </span><br></pre></td></tr></table></figure><h3 id="编写proto"><a href="#编写proto" class="headerlink" title="编写proto"></a>编写<code>proto</code></h3><p>在<code>Protos</code>文件夹中添加文件<code>Order.proto</code>，具体内容如下：</p><figure class="highlight proto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">option</span> csharp_namespace = <span class="string">&quot;GrpcDemo.Protos&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">message </span><span class="title class_">Order</span>&#123;  </span><br><span class="line">	<span class="type">int32</span> Id = <span class="number">1</span>;  </span><br><span class="line">	<span class="type">string</span> OrderNo = <span class="number">2</span>;  </span><br><span class="line">	<span class="type">int32</span> Status = <span class="number">3</span>;  </span><br><span class="line">	<span class="type">float</span> Payment = <span class="number">4</span>;  </span><br><span class="line">	<span class="keyword">repeated</span> OrderProduct Products = <span class="number">5</span>;  </span><br><span class="line">	OrderAddress Address = <span class="number">6</span>;  </span><br><span class="line">	<span class="type">int32</span> OrderOwner = <span class="number">7</span>;  </span><br><span class="line">  </span><br><span class="line">	<span class="keyword">message </span><span class="title class_">OrderProduct</span>&#123;  </span><br><span class="line">		<span class="type">string</span> ProductTitle = <span class="number">1</span>;  </span><br><span class="line">		<span class="type">string</span> SkuTitle = <span class="number">2</span>;  </span><br><span class="line">		<span class="type">int32</span> Num = <span class="number">3</span>;  </span><br><span class="line">		<span class="type">float</span> UnitPrice = <span class="number">4</span>;  </span><br><span class="line">	&#125;  </span><br><span class="line">  </span><br><span class="line">	<span class="keyword">message </span><span class="title class_">OrderAddress</span>&#123;  </span><br><span class="line">		<span class="type">string</span> Province = <span class="number">1</span>;  </span><br><span class="line">		<span class="type">string</span> City = <span class="number">2</span>;  </span><br><span class="line">		<span class="type">string</span> Districe = <span class="number">3</span>;  </span><br><span class="line">		<span class="type">string</span> Detail = <span class="number">4</span>;  </span><br><span class="line">		<span class="type">string</span> Name = <span class="number">5</span>;  </span><br><span class="line">		<span class="type">string</span> Mobile = <span class="number">6</span>;  </span><br><span class="line">	&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">message </span><span class="title class_">GetByOrderNoRequest</span>&#123;  </span><br><span class="line">	<span class="type">string</span> OrderNo = <span class="number">1</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">message </span><span class="title class_">GetByOwnerRequest</span>&#123;  </span><br><span class="line">	<span class="type">int32</span> OrderOwner = <span class="number">1</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">message </span><span class="title class_">BatchAddOrderNoReturnResponse</span>&#123;  </span><br><span class="line">	<span class="type">bool</span> IsAllSuccess = <span class="number">1</span>;  </span><br><span class="line">	<span class="keyword">repeated</span> <span class="type">string</span> FailOrderNo = <span class="number">2</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">service </span><span class="title class_">OrderService</span>&#123;  </span><br><span class="line">	<span class="function"><span class="keyword">rpc</span> GetByOrderNo(GetByOrderNoRequest) <span class="keyword">returns</span>(Order)</span>;  </span><br><span class="line">	<span class="function"><span class="keyword">rpc</span> GetByOwner(GetByOwnerRequest) <span class="keyword">returns</span>(stream Order)</span>;  </span><br><span class="line">	<span class="function"><span class="keyword">rpc</span> AddOrder(Order) <span class="keyword">returns</span>(Order)</span>;  </span><br><span class="line">	<span class="function"><span class="keyword">rpc</span> BatchAddOrder(stream Order) <span class="keyword">returns</span>(stream Order)</span>;  </span><br><span class="line">	<span class="function"><span class="keyword">rpc</span> BatchAddOrderNoReturn(stream Order) <span class="keyword">returns</span>(BatchAddOrderNoReturnResponse)</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>在<code>解决方案资源管理器</code>找到<code>Order.proto</code>文件，右键 -&gt; 属性 -&gt; <code>Build Action</code>选择<code>Protobuf compiler</code> -&gt; <code>gRPC Stub Classes</code>选择<code>Server only</code></p><p>编译一次项目</p><h3 id="编写测试数据"><a href="#编写测试数据" class="headerlink" title="编写测试数据"></a>编写测试数据</h3><p>在<code>Data</code>文件夹创建<code>InMemoryData.cs</code>文件，内容如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;  </span><br><span class="line"><span class="keyword">using</span> GrpcDemo.Protos;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GrpcServerDemo.Data</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InMemoryData</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Order&gt; Orders = <span class="keyword">new</span> List&lt;Order&gt;()  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">new</span> Order()  </span><br><span class="line">            &#123;  </span><br><span class="line">                Id = <span class="number">1</span>,  </span><br><span class="line">                OrderNo = <span class="string">&quot;2020042201&quot;</span>,  </span><br><span class="line">                Status = <span class="number">1</span>,  </span><br><span class="line">                Payment = <span class="number">43141.98f</span>,  </span><br><span class="line">                Products =  </span><br><span class="line">                &#123;  </span><br><span class="line">                    <span class="keyword">new</span> Order.Types.OrderProduct()  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        ProductTitle = <span class="string">&quot;Apple iPhone11&quot;</span>,  </span><br><span class="line">                        SkuTitle = <span class="string">&quot;256GB 黑色&quot;</span>,  </span><br><span class="line">                        Num = <span class="number">2</span>,  </span><br><span class="line">                        UnitPrice = <span class="number">9999.99f</span>  </span><br><span class="line">                    &#125;,  </span><br><span class="line">                    <span class="keyword">new</span> Order.Types.OrderProduct()  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        ProductTitle = <span class="string">&quot;Apple MacBook Pro&quot;</span>,  </span><br><span class="line">                        SkuTitle = <span class="string">&quot;i7 512GB 灰色&quot;</span>,  </span><br><span class="line">                        Num = <span class="number">1</span>,  </span><br><span class="line">                        UnitPrice = <span class="number">23142</span>  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;,  </span><br><span class="line">                Address = <span class="keyword">new</span> Order.Types.OrderAddress()  </span><br><span class="line">                &#123;  </span><br><span class="line">                    Province = <span class="string">&quot;广东省&quot;</span>,  </span><br><span class="line">                    City = <span class="string">&quot;深圳市&quot;</span>,  </span><br><span class="line">                    Districe = <span class="string">&quot;南山区&quot;</span>,  </span><br><span class="line">                    Detail = <span class="string">&quot;Nanshan Road 1234&quot;</span>,  </span><br><span class="line">                    Name = <span class="string">&quot;Jiamiao.x&quot;</span>,  </span><br><span class="line">                    Mobile = <span class="string">&quot;13500000000&quot;</span>  </span><br><span class="line">                &#125;,  </span><br><span class="line">                OrderOwner = <span class="number">100</span>,  </span><br><span class="line">            &#125;,  </span><br><span class="line">            <span class="keyword">new</span> Order()  </span><br><span class="line">            &#123;  </span><br><span class="line">                Id = <span class="number">2</span>,  </span><br><span class="line">                OrderNo = <span class="string">&quot;2020042202&quot;</span>,  </span><br><span class="line">                Status = <span class="number">2</span>,  </span><br><span class="line">                Payment = <span class="number">56.00f</span>,  </span><br><span class="line">                Products =  </span><br><span class="line">                &#123;  </span><br><span class="line">                    <span class="keyword">new</span> Order.Types.OrderProduct()  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        ProductTitle = <span class="string">&quot;ASP.NET Core微服务实战&quot;</span>,  </span><br><span class="line">                        SkuTitle = <span class="string">&quot;1本&quot;</span>,  </span><br><span class="line">                        Num = <span class="number">1</span>,  </span><br><span class="line">                        UnitPrice = <span class="number">56.00f</span>  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;,  </span><br><span class="line">                Address = <span class="keyword">new</span> Order.Types.OrderAddress()  </span><br><span class="line">                &#123;  </span><br><span class="line">                    Province = <span class="string">&quot;广东省&quot;</span>,  </span><br><span class="line">                    City = <span class="string">&quot;深圳市&quot;</span>,  </span><br><span class="line">                    Districe = <span class="string">&quot;南山区&quot;</span>,  </span><br><span class="line">                    Detail = <span class="string">&quot;Nanshan Road 1234&quot;</span>,  </span><br><span class="line">                    Name = <span class="string">&quot;Jiamiao.x&quot;</span>,  </span><br><span class="line">                    Mobile = <span class="string">&quot;13500000000&quot;</span>  </span><br><span class="line">                &#125;,  </span><br><span class="line">                OrderOwner = <span class="number">100</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p><strong>注意：这里的<code>Order</code>是<code>gRPC</code>生成的，命名空间为<code>GrpcDemo.Protos</code></strong></p><h3 id="编写Service"><a href="#编写Service" class="headerlink" title="编写Service"></a>编写<code>Service</code></h3><p>在<code>Services</code>文件夹创建<code>DemoOrderService.cs</code>文件，内容如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;  </span><br><span class="line"><span class="keyword">using</span> System.Linq;  </span><br><span class="line"><span class="keyword">using</span> System.Threading;  </span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;  </span><br><span class="line"><span class="keyword">using</span> Grpc.Core;  </span><br><span class="line"><span class="keyword">using</span> GrpcDemo.Protos;  </span><br><span class="line"><span class="keyword">using</span> GrpcServerDemo.Data;  </span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Logging;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GrpcServerDemo.Services</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DemoOrderService</span> : <span class="title">OrderService.OrderServiceBase</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;DemoOrderService&gt; _logger;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">DemoOrderService</span>(<span class="params">ILogger&lt;DemoOrderService&gt; logger</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            _logger = logger;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">async</span> Task&lt;Order&gt; <span class="title">GetByOrderNo</span>(<span class="params">GetByOrderNoRequest request, ServerCallContext context</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            _logger.LogInformation(<span class="string">&quot;有人请求接口 -&gt; GetByOrderNo&quot;</span>);  </span><br><span class="line">            <span class="keyword">var</span> metaData = context.RequestHeaders;  </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> metaData)  </span><br><span class="line">            &#123;  </span><br><span class="line">                _logger.LogInformation(<span class="string">$&quot;<span class="subst">&#123;item.Key&#125;</span>: <span class="subst">&#123;item.Value&#125;</span>&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">await</span> Task.CompletedTask;  </span><br><span class="line">            <span class="keyword">var</span> dbValue = InMemoryData.Orders.FirstOrDefault(x =&gt; x.OrderNo == request.OrderNo);  </span><br><span class="line">            <span class="keyword">if</span> (dbValue != <span class="literal">null</span>)  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">return</span> dbValue;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span>  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">throw</span>  <span class="keyword">new</span> Exception(<span class="string">&quot;订单号错误&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">async</span> Task <span class="title">GetByOwner</span>(<span class="params">GetByOwnerRequest request, IServerStreamWriter&lt;Order&gt; responseStream, ServerCallContext context</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            _logger.LogInformation(<span class="string">&quot;有人请求接口 -&gt; GetByOwner&quot;</span>);  </span><br><span class="line">            <span class="keyword">var</span> dbValue = InMemoryData.Orders.Where(x =&gt; x.OrderOwner == request.OrderOwner);  </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> dbValue)  </span><br><span class="line">            &#123;  </span><br><span class="line">                Thread.Sleep(<span class="number">2000</span>);  </span><br><span class="line">                _logger.LogInformation(<span class="string">$&quot;发送数据：<span class="subst">&#123;item&#125;</span>&quot;</span>);  </span><br><span class="line">                <span class="keyword">await</span> responseStream.WriteAsync(item);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">async</span> Task&lt;Order&gt; <span class="title">AddOrder</span>(<span class="params">Order request, ServerCallContext context</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            _logger.LogInformation(<span class="string">&quot;有人请求接口 -&gt; AddOrder&quot;</span>);  </span><br><span class="line">            <span class="keyword">await</span> Task.CompletedTask;  </span><br><span class="line">            request.Id = InMemoryData.Orders.Max(x =&gt; x.Id) + <span class="number">1</span>;  </span><br><span class="line">            InMemoryData.Orders.Add(request);  </span><br><span class="line">            <span class="keyword">return</span> request;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">async</span> Task <span class="title">BatchAddOrder</span>(<span class="params">IAsyncStreamReader&lt;Order&gt; requestStream, IServerStreamWriter&lt;Order&gt; responseStream, ServerCallContext context</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            _logger.LogInformation(<span class="string">&quot;有人请求接口 -&gt; BatchAddOrder&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">await</span> requestStream.MoveNext())  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">var</span> inputOrder = requestStream.Current;  </span><br><span class="line">                <span class="keyword">lock</span> (<span class="keyword">this</span>)  </span><br><span class="line">                &#123;  </span><br><span class="line">                    _logger.LogInformation(<span class="string">$&quot;接受数据：<span class="subst">&#123;inputOrder&#125;</span>&quot;</span>);  </span><br><span class="line">                    inputOrder.Id = InMemoryData.Orders.Max(x =&gt; x.Id) + <span class="number">1</span>;  </span><br><span class="line">                    InMemoryData.Orders.Add(inputOrder);  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">await</span> responseStream.WriteAsync(inputOrder);  </span><br><span class="line">                Thread.Sleep(<span class="number">5000</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p><strong>注意：这里的<code>OrderService.OrderServiceBase</code>一样是<code>gRPC</code>生成的，命名空间为<code>GrpcDemo.Protos</code></strong></p><h3 id="修改Startup"><a href="#修改Startup" class="headerlink" title="修改Startup"></a>修改<code>Startup</code></h3><p>修改<code>Startup.cs</code>，内容如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> GrpcServerDemo.Services;  </span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Builder;  </span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Hosting;  </span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;  </span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Hosting;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GrpcServerDemo</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Startup</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            services.AddGrpc();  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app, IWebHostEnvironment env</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">if</span> (env.IsDevelopment())  </span><br><span class="line">            &#123;  </span><br><span class="line">                app.UseDeveloperExceptionPage();  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            app.UseHttpsRedirection();  </span><br><span class="line">            app.UseRouting();  </span><br><span class="line">  </span><br><span class="line">            app.UseEndpoints(endpoints =&gt;  </span><br><span class="line">            &#123;  </span><br><span class="line">                endpoints.MapGrpcService&lt;DemoOrderService&gt;();  </span><br><span class="line">            &#125;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><h3 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h3><p>在<code>Powershell</code>中进入到项目根目录，直接<code>dotnet run</code>运行目录即可</p><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>创建名字为<code>GrpcClientDemo</code>的<code>控制台应用</code>，通过<code>nuget</code>引入以下三个包：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Google.Protobuf  </span><br><span class="line">Grpc.Net.Client  </span><br><span class="line">Grpc.Tools  </span><br></pre></td></tr></table></figure><h3 id="复制proto文件"><a href="#复制proto文件" class="headerlink" title="复制proto文件"></a>复制<code>proto</code>文件</h3><p>将服务端<code>GrpcServerDemo</code>的<code>Protos</code>文件夹拷贝到项目根目录，在<code>解决方案资源管理器</code>找到<code>Order.proto</code>文件，右键 -&gt; 属性 -&gt; <code>Build Action</code>选择<code>Protobuf compiler</code> -&gt; <code>gRPC Stub Classes</code>选择<code>Client only</code></p><h3 id="修改Program-cs"><a href="#修改Program-cs" class="headerlink" title="修改Program.cs"></a>修改<code>Program.cs</code></h3><p>修改<code>Program.cs</code>文件，内容如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;  </span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;  </span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;  </span><br><span class="line"><span class="keyword">using</span> Grpc.Core;  </span><br><span class="line"><span class="keyword">using</span> Grpc.Net.Client;  </span><br><span class="line"><span class="keyword">using</span> GrpcDemo.Protos;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GrpcClientDemo</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>\[\] <span class="keyword">args</span></span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">using</span> <span class="keyword">var</span> channel = GrpcChannel.ForAddress(<span class="string">&quot;https://localhost:5001&quot;</span>);  </span><br><span class="line">            <span class="keyword">var</span> client = <span class="keyword">new</span> OrderService.OrderServiceClient(channel);  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">var</span> option = <span class="built_in">int</span>.Parse(<span class="keyword">args</span>\[<span class="number">0</span>\]);  </span><br><span class="line">            <span class="keyword">switch</span> (option)  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:  </span><br><span class="line">                    <span class="keyword">await</span> GetByOrderNoAsync(client);  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:  </span><br><span class="line">                    <span class="keyword">await</span> GetByOwner(client);  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:  </span><br><span class="line">                    <span class="keyword">await</span> AddOrder(client);  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:  </span><br><span class="line">                    <span class="keyword">await</span> BatchAddOrder(client);  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            Console.WriteLine(<span class="string">&quot;==========END==========&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">GetByOrderNoAsync</span>(<span class="params">OrderService.OrderServiceClient client</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">var</span> metaData = <span class="keyword">new</span> Metadata()  </span><br><span class="line">            &#123;  </span><br><span class="line">                &#123;<span class="string">&quot;userName&quot;</span>, <span class="string">&quot;jiamiao.x&quot;</span>&#125;,  </span><br><span class="line">                &#123;<span class="string">&quot;clientName&quot;</span>, <span class="string">&quot;GrpcClientDemo&quot;</span>&#125;  </span><br><span class="line">            &#125;;  </span><br><span class="line">            <span class="keyword">var</span> response = <span class="keyword">await</span> client.GetByOrderNoAsync(<span class="keyword">new</span> GetByOrderNoRequest() &#123;OrderNo = <span class="string">&quot;2020042201&quot;</span>&#125;,metaData);  </span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;接收到数据：<span class="subst">&#123;response&#125;</span>&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">GetByOwner</span>(<span class="params">OrderService.OrderServiceClient client</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">var</span> response = client.GetByOwner(<span class="keyword">new</span> GetByOwnerRequest() &#123;OrderOwner = <span class="number">100</span>&#125;);  </span><br><span class="line">            <span class="keyword">var</span> responseStream = response.ResponseStream;  </span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">await</span> responseStream.MoveNext())  </span><br><span class="line">            &#123;  </span><br><span class="line">                Console.WriteLine(<span class="string">$&quot;接收到数据：<span class="subst">&#123;responseStream.Current&#125;</span>&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;数据接收完毕&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">AddOrder</span>(<span class="params">OrderService.OrderServiceClient client</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">var</span> order = <span class="keyword">new</span> Order()  </span><br><span class="line">            &#123;  </span><br><span class="line">                OrderNo = <span class="string">&quot;2020042301&quot;</span>,  </span><br><span class="line">                Status = <span class="number">1</span>,  </span><br><span class="line">                Payment = <span class="number">43141.98f</span>,  </span><br><span class="line">                Products =  </span><br><span class="line">                &#123;  </span><br><span class="line">                    <span class="keyword">new</span> Order.Types.OrderProduct()  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        ProductTitle = <span class="string">&quot;OnePlus 7T&quot;</span>,  </span><br><span class="line">                        SkuTitle = <span class="string">&quot;256GB 蓝色&quot;</span>,  </span><br><span class="line">                        Num = <span class="number">1</span>,  </span><br><span class="line">                        UnitPrice = <span class="number">3600f</span>  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;,  </span><br><span class="line">                Address = <span class="keyword">new</span> Order.Types.OrderAddress()  </span><br><span class="line">                &#123;  </span><br><span class="line">                    Province = <span class="string">&quot;广东省&quot;</span>,  </span><br><span class="line">                    City = <span class="string">&quot;深圳市&quot;</span>,  </span><br><span class="line">                    Districe = <span class="string">&quot;南山区&quot;</span>,  </span><br><span class="line">                    Detail = <span class="string">&quot;北科大厦7003&quot;</span>,  </span><br><span class="line">                    Name = <span class="string">&quot;Jiamiao.x&quot;</span>,  </span><br><span class="line">                    Mobile = <span class="string">&quot;13822113366&quot;</span>  </span><br><span class="line">                &#125;,  </span><br><span class="line">                OrderOwner = <span class="number">100</span>,  </span><br><span class="line">            &#125;;  </span><br><span class="line">            <span class="keyword">var</span> response = <span class="keyword">await</span> client.AddOrderAsync(order);  </span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;接收到数据：<span class="subst">&#123;response&#125;</span>&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">BatchAddOrder</span>(<span class="params">OrderService.OrderServiceClient client</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">var</span> orders = <span class="keyword">new</span> List&lt;Order&gt;()  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">new</span> Order()  </span><br><span class="line">                &#123;  </span><br><span class="line">                    OrderNo = <span class="string">&quot;2020042301&quot;</span>,  </span><br><span class="line">                    Status = <span class="number">1</span>,  </span><br><span class="line">                    Payment = <span class="number">3600f</span>,  </span><br><span class="line">                    Products =  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        <span class="keyword">new</span> Order.Types.OrderProduct()  </span><br><span class="line">                        &#123;  </span><br><span class="line">                            ProductTitle = <span class="string">&quot;OnePlus 7T&quot;</span>,  </span><br><span class="line">                            SkuTitle = <span class="string">&quot;256GB 蓝色&quot;</span>,  </span><br><span class="line">                            Num = <span class="number">1</span>,  </span><br><span class="line">                            UnitPrice = <span class="number">3600f</span>  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;,  </span><br><span class="line">                    Address = <span class="keyword">new</span> Order.Types.OrderAddress()  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        Province = <span class="string">&quot;广东省&quot;</span>,  </span><br><span class="line">                        City = <span class="string">&quot;深圳市&quot;</span>,  </span><br><span class="line">                        Districe = <span class="string">&quot;南山区&quot;</span>,  </span><br><span class="line">                        Detail = <span class="string">&quot;北科大厦7003&quot;</span>,  </span><br><span class="line">                        Name = <span class="string">&quot;Jiamiao.x&quot;</span>,  </span><br><span class="line">                        Mobile = <span class="string">&quot;13822113366&quot;</span>  </span><br><span class="line">                    &#125;,  </span><br><span class="line">                    OrderOwner = <span class="number">100</span>,  </span><br><span class="line">                &#125;,  </span><br><span class="line">                <span class="keyword">new</span> Order()  </span><br><span class="line">                &#123;  </span><br><span class="line">                    OrderNo = <span class="string">&quot;2020042302&quot;</span>,  </span><br><span class="line">                    Status = <span class="number">1</span>,  </span><br><span class="line">                    Payment = <span class="number">13999.99f</span>,  </span><br><span class="line">                    Products =  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        <span class="keyword">new</span> Order.Types.OrderProduct()  </span><br><span class="line">                        &#123;  </span><br><span class="line">                            ProductTitle = <span class="string">&quot;SONY PS4 Pro&quot;</span>,  </span><br><span class="line">                            SkuTitle = <span class="string">&quot;1TB 黑色&quot;</span>,  </span><br><span class="line">                            Num = <span class="number">1</span>,  </span><br><span class="line">                            UnitPrice = <span class="number">3999.99f</span>  </span><br><span class="line">                        &#125;,  </span><br><span class="line">                        <span class="keyword">new</span> Order.Types.OrderProduct()  </span><br><span class="line">                        &#123;  </span><br><span class="line">                            ProductTitle = <span class="string">&quot;Surface Desktop Pro&quot;</span>,  </span><br><span class="line">                            SkuTitle = <span class="string">&quot;1TB 白色&quot;</span>,  </span><br><span class="line">                            Num = <span class="number">1</span>,  </span><br><span class="line">                            UnitPrice = <span class="number">13999.99f</span>  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;,  </span><br><span class="line">                    Address = <span class="keyword">new</span> Order.Types.OrderAddress()  </span><br><span class="line">                    &#123;  </span><br><span class="line">                        Province = <span class="string">&quot;广东省&quot;</span>,  </span><br><span class="line">                        City = <span class="string">&quot;深圳市&quot;</span>,  </span><br><span class="line">                        Districe = <span class="string">&quot;南山区&quot;</span>,  </span><br><span class="line">                        Detail = <span class="string">&quot;北科大厦7003&quot;</span>,  </span><br><span class="line">                        Name = <span class="string">&quot;Jiamiao.x&quot;</span>,  </span><br><span class="line">                        Mobile = <span class="string">&quot;13822113366&quot;</span>  </span><br><span class="line">                    &#125;,  </span><br><span class="line">                    OrderOwner = <span class="number">100</span>,  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;;  </span><br><span class="line">            <span class="keyword">var</span> call = client.BatchAddOrder();  </span><br><span class="line">              </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> order <span class="keyword">in</span> orders)  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">await</span> call.RequestStream.WriteAsync(order);  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">await</span> call.RequestStream.CompleteAsync();  </span><br><span class="line">            Console.WriteLine(<span class="string">&quot;----数据发送完毕----&quot;</span>);  </span><br><span class="line">            <span class="keyword">await</span> Task.Run(<span class="keyword">async</span> () =&gt;  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">await</span> call.ResponseStream.MoveNext())  </span><br><span class="line">                &#123;  </span><br><span class="line">                    Console.WriteLine(<span class="string">$&quot;接收到消息：<span class="subst">&#123;call.ResponseStream.Current&#125;</span>&quot;</span>);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><h3 id="运行项目-1"><a href="#运行项目-1" class="headerlink" title="运行项目"></a>运行项目</h3><p>在<code>Powershell</code>进入到项目根目录，使用<code>dotnet run [arg]</code>运行项目既可以看到效果，<code>[arg]</code>是对应<code>switch</code>里的参数</p><h1 id="日志和异常"><a href="#日志和异常" class="headerlink" title="日志和异常"></a>日志和异常</h1><h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h3 id="ASP-NET-Core-1"><a href="#ASP-NET-Core-1" class="headerlink" title="ASP.NET Core"></a>ASP.NET Core</h3><p>作为服务端在<code>ASP.NET Core</code>中开启<code>gRPC</code>日志只需要在<code>appsettings.json</code>中配置<code>grpc</code>的日志等级即可，修改<code>appsettings.json</code>内容如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">  <span class="string">&quot;Logging&quot;</span>: &#123;  </span><br><span class="line">    <span class="string">&quot;LogLevel&quot;</span>: &#123;  </span><br><span class="line">      <span class="string">&quot;Default&quot;</span>: <span class="string">&quot;Information&quot;</span>,  </span><br><span class="line">      <span class="string">&quot;Microsoft&quot;</span>: <span class="string">&quot;Warning&quot;</span>,  </span><br><span class="line">      <span class="string">&quot;Microsoft.Hosting.Lifetime&quot;</span>: <span class="string">&quot;Information&quot;</span>,  </span><br><span class="line">      <span class="string">&quot;grpc&quot;</span>: <span class="string">&quot;Debug&quot;</span>   </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;,  </span><br><span class="line">  <span class="string">&quot;AllowedHosts&quot;</span>: <span class="string">&quot;\*&quot;</span>  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>运行项目就可以看到控制台打印出<code>gRPC</code>相关日志</p><h3 id="NET-Core控制台"><a href="#NET-Core控制台" class="headerlink" title=".NET Core控制台"></a>.NET Core控制台</h3><p>在客户端的<code>.NET Core控制台程序</code>，需要自定义一个<code>LoggerFactory</code>，然后在创建<code>Channel</code>的时候指定自定义的<code>LoggerFactory</code>。这里的示例使用<code>Serilog</code>来作为日志组件，需要在引入以下三个包：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Serilog  </span><br><span class="line">Serilog.Extensions.Logging  </span><br><span class="line">Serilog.Sinks.Console  </span><br></pre></td></tr></table></figure><p>创建<code>SerilogLoggerFactory.cs</code>，内容如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Logging;  </span><br><span class="line"><span class="keyword">using</span> Serilog.Debugging;  </span><br><span class="line"><span class="keyword">using</span> Serilog.Extensions.Logging;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Jiamiao.x.GrpcClient</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SerilogLoggerFactory</span>:<span class="title">ILoggerFactory</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> SerilogLoggerProvider _provider;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SerilogLoggerFactory</span>(<span class="params">Serilog.ILogger logger=<span class="literal">null</span>,<span class="built_in">bool</span> dispose = <span class="literal">false</span></span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            _provider = <span class="keyword">new</span> SerilogLoggerProvider(logger, dispose);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>()</span> =&gt; _provider.Dispose();  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> ILogger <span class="title">CreateLogger</span>(<span class="params"><span class="built_in">string</span> categoryName</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">return</span> _provider.CreateLogger(categoryName);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddProvider</span>(<span class="params">ILoggerProvider provider</span>)</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            SelfLog.WriteLine(<span class="string">&quot;Ignore added logger provider &#123;0&#125;&quot;</span>, provider);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>回到<code>gRPC</code>服务调用的地方，将创建<code>GrpcChannel</code>的代码修改如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> channel = GrpcChannel.ForAddress(<span class="string">&quot;https://localhost:5001&quot;</span>,<span class="keyword">new</span> GrpcChannelOptions()  </span><br><span class="line">&#123;  </span><br><span class="line">    LoggerFactory = <span class="keyword">new</span> SerilogLoggerFactory()  </span><br><span class="line">&#125;);  </span><br></pre></td></tr></table></figure><p>运行项目即可以看到<code>gRPC</code>日志内容</p><h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><p>服务端在<code>gRPC</code>抛出异常的时候，可以抛出<code>RpcException</code>来指定异常类型，<code>RpcException</code>示例里的<code>trailer</code>是一个<code>Metadata</code>，可以携带自定义的键值对，客户端捕获异常也可以捕获指定的<code>RpcException</code>，一样可以拿到<code>trailer</code>来获取自定义的键值对信息</p><h1 id="关于JWT授权"><a href="#关于JWT授权" class="headerlink" title="关于JWT授权"></a>关于JWT授权</h1><p>在通过授权接口获取到<code>JWT Token</code>之后，与普通<code>HTTP</code>请求类似，<code>JWT Token</code>也是放在头部与请求一起发送出去，只不过在<code>RPC</code>换了个名词，编程<code>MetaData</code>，其实是一样道理，用<code>Authorization:Bearer &#123;JWT Token&#125;</code>来进行发送即可</p><h1 id="多项目之间共享proto文件"><a href="#多项目之间共享proto文件" class="headerlink" title="多项目之间共享proto文件"></a>多项目之间共享<code>proto</code>文件</h1><ul><li>使用单独的<code>Git</code>仓库管理<code>proto</code>文件</li><li>使用<code>submodule</code>将<code>proto</code>文件集成到工程目录中</li><li>使用<code>dotnet-grpc</code>命令行添加<code>proto</code>文件及祥光依赖包引用</li></ul><p><em>备注：由<code>proto</code>生成的代码文件会存放在<code>obj</code>目录中，不会被嵌入到<code>Git</code>仓库</em></p></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/commonlyUsed/avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/commonlyUsed/avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Fantasy-ke</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.fantasyke.cn/posts/896e333f.html">原创</a><a class="post-copyright-title"><span onclick='rm.copyPageUrl("https://blog.fantasyke.cn/posts/896e333f.html")'>gRPC in ASP.NET Core</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://filebed.fantasyke.cn/file/commonlyUsed/qrcode/qrcode-weichat.jpg" target="_blank"><img class="post-qr-code-img" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/commonlyUsed/qrcode/qrcode-weichat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://filebed.fantasyke.cn/file/commonlyUsed/qrcode/qrcode-alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/commonlyUsed/qrcode/qrcode-alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.fantasyke.cn/posts/896e333f.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=gRPC in ASP.NET Core&amp;url=https://blog.fantasyke.cn/posts/896e333f.html&amp;pic=https://filebed.fantasyke.cn/file/wallpaper/748a31364d194d419020419f204265f0.6wqtgcnicr.webp?_r_=d77abe90-8ef1-ef20-f1a5-b3e5ba352c86" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.fantasyke.cn" target="_blank">Fantasy`Ke Blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/ASP-NET-Core/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span> ASP.NET Core<span class="tagsPageCount">4</span></a><a class="post-meta__box__tags" href="/tags/gRPC/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span> gRPC<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/fantasy-ke/picx-images-hosting/master/notion/de91d8193c1b7d27e88f220af42a71b8.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/16223.html"><img class="prev-cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/45663c9f2ce54eb2ae8628efb0c43390.8vn0b0iqtf.webp?_r_=4e1d5607-b8fc-6561-7cc9-a1b98896e206" onerror='onerror=null,src="/img/friend_404.gif"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">编码技巧 --- 同步锁对象的选定</div></div></a></div><div class="next-post pull-right"><a href="/posts/26716.html"><img class="next-cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/3.2a56fnoyou.webp?_r_=2d9d7422-f6aa-70de-b830-84d130267e3f" onerror='onerror=null,src="/img/friend_404.gif"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">并发编程 --- 信号量线程同步</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/6c86af72.html" title=".NET Core使用Cap"><img class="cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/bab9141327ca48e39abef6229b79cf9c.361nzfodah.webp?_r_=273e891c-5427-c938-6154-a12853ad80ff" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-07-08</div><div class="title">.NET Core使用Cap</div></div></a></div><div><a href="/posts/fa354dcb.html" title="MediatR：轻松实现命令查询职责分离模式(CQRS)"><img class="cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/3.2a56fnoyou.webp?_r_=2582c235-ea38-ce15-8c42-18396017a630" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-06-26</div><div class="title">MediatR：轻松实现命令查询职责分离模式(CQRS)</div></div></a></div><div><a href="/posts/c2a085fc.html" title="EntityFramework Core的并发处理"><img class="cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/a202c44c2075478dbfac39baeb800046.4qreywlkrf.webp?_r_=d92666b9-3b4a-edab-011f-60b65799b418" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-07-05</div><div class="title">EntityFramework Core的并发处理</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i> <span>评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#VSCode"><span class="toc-number">1.1.</span> <span class="toc-text">VSCode</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%BC%94%E8%BF%9B"><span class="toc-number">2.</span> <span class="toc-text">消息类型的演进</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%A7%84%E5%88%99"><span class="toc-number">2.1.</span> <span class="toc-text">更新消息类型的规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">2.2.</span> <span class="toc-text">默认值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE"><span class="toc-number">2.3.</span> <span class="toc-text">枚举</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8-NET-Core%E4%B8%AD%E4%BD%BF%E7%94%A8gRPC"><span class="toc-number">3.</span> <span class="toc-text">在.NET Core中使用gRPC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ASP-NET-Core"><span class="toc-number">3.1.</span> <span class="toc-text">ASP.NET Core</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NET-Core"><span class="toc-number">3.2.</span> <span class="toc-text">.NET Core</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%8C%85%E4%B9%8B%E5%90%8E%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.3.</span> <span class="toc-text">引包之后的操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.4.</span> <span class="toc-text">作为服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">3.5.</span> <span class="toc-text">作为客户端</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8A%E4%BB%A3%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">上代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">4.1.</span> <span class="toc-text">服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95"><span class="toc-number">4.1.1.</span> <span class="toc-text">创建目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99proto"><span class="toc-number">4.1.2.</span> <span class="toc-text">编写proto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">4.1.3.</span> <span class="toc-text">编写测试数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99Service"><span class="toc-number">4.1.4.</span> <span class="toc-text">编写Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9Startup"><span class="toc-number">4.1.5.</span> <span class="toc-text">修改Startup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.1.6.</span> <span class="toc-text">运行项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">4.2.</span> <span class="toc-text">客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.2.1.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6proto%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.2.</span> <span class="toc-text">复制proto文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9Program-cs"><span class="toc-number">4.2.3.</span> <span class="toc-text">修改Program.cs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE-1"><span class="toc-number">4.2.4.</span> <span class="toc-text">运行项目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%92%8C%E5%BC%82%E5%B8%B8"><span class="toc-number">5.</span> <span class="toc-text">日志和异常</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">5.1.</span> <span class="toc-text">日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ASP-NET-Core-1"><span class="toc-number">5.1.1.</span> <span class="toc-text">ASP.NET Core</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NET-Core%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-number">5.1.2.</span> <span class="toc-text">.NET Core控制台</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8"><span class="toc-number">5.2.</span> <span class="toc-text">异常</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EJWT%E6%8E%88%E6%9D%83"><span class="toc-number">6.</span> <span class="toc-text">关于JWT授权</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B9%E7%9B%AE%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%ABproto%E6%96%87%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">多项目之间共享proto文件</span></a></li></ol></div></div><div class="card-widget" id="card-poem"><div id="poem_sentence"></div><div id="poem_info"><div id="poem_dynasty"></div><div id="poem_author"></div></div></div><script src="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/jinrishici.js" charset="utf-8"></script><script>jinrishici.load((function(e){var n=document.querySelector("#poem_sentence"),t=document.querySelector("#poem_author"),o=document.querySelector("#poem_dynasty"),r=e.data.content;r=r.substr(0,r.length-1),n.innerHTML=r,o.innerHTML=e.data.origin.dynasty,t.innerHTML=e.data.origin.author+"《"+e.data.origin.title+"》"}))</script><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/30618.html" title="面试场景问题"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://raw.githubusercontent.com/fantasy-ke/picx-images-hosting/master/notion/de91d8193c1b7d27e88f220af42a71b8.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="面试场景问题"></a><div class="content"><a class="title" href="/posts/30618.html" title="面试场景问题">面试场景问题</a><time datetime="2025-07-10T17:46:00.000Z" title="发表于 2025-07-10 17:46:00">2025-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a65df701.html" title="Notion + Hexo + GitHub Actions + Vercel 博客解决方案"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://raw.githubusercontent.com/fantasy-ke/picx-images-hosting/master/notion/a1cb98277a184ae4e927e36e72b75d2c.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="Notion + Hexo + GitHub Actions + Vercel 博客解决方案"></a><div class="content"><a class="title" href="/posts/a65df701.html" title="Notion + Hexo + GitHub Actions + Vercel 博客解决方案">Notion + Hexo + GitHub Actions + Vercel 博客解决方案</a><time datetime="2025-02-13T10:52:00.000Z" title="发表于 2025-02-13 10:52:00">2025-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cfaae164.html" title="Notion-Hexo 的 Elog 配置详解"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://raw.githubusercontent.com/fantasy-ke/picx-images-hosting/master/notion/de91d8193c1b7d27e88f220af42a71b8.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="Notion-Hexo 的 Elog 配置详解"></a><div class="content"><a class="title" href="/posts/cfaae164.html" title="Notion-Hexo 的 Elog 配置详解">Notion-Hexo 的 Elog 配置详解</a><time datetime="2025-02-13T10:52:00.000Z" title="发表于 2025-02-13 10:52:00">2025-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6077dc15.html" title="在.NET Core中使用异步多线程消费"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/2.1e8oyqkl2f.webp?_r_=c6d862a0-ef8f-4514-34db-d9247366d3e0" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="在.NET Core中使用异步多线程消费"></a><div class="content"><a class="title" href="/posts/6077dc15.html" title="在.NET Core中使用异步多线程消费">在.NET Core中使用异步多线程消费</a><time datetime="2024-12-24T09:40:02.000Z" title="发表于 2024-12-24 09:40:02">2024-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a2b0f015.html" title="C#8.0 可空引用类型"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/29842afd880511ebb6edd017c2d2eca2.2rv88kg2f5.webp?_r_=13f95f2f-2aad-b49b-e1a1-357d499bc067" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="C#8.0 可空引用类型"></a><div class="content"><a class="title" href="/posts/a2b0f015.html" title="C#8.0 可空引用类型">C#8.0 可空引用类型</a><time datetime="2024-12-17T09:40:02.000Z" title="发表于 2024-12-17 09:40:02">2024-12-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:contact@fantasyke.cn" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2246080525&amp;site=qq&amp;menu=yes" title="QQ"><i class="anzhiyufont anzhiyu-icon-qq"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="/static/images/footer.gif" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/fantasy-ke" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.youtube.com/@%E5%91%A8%E6%A2%A6-z9i" title="YouTube"><i class="fab fa-youtube"></i></a></div><div id="workboard"><img class="workSituationImg boardsign" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/blogOther/shangban.2obnt8s19a.svg" alt="距离月入20k也就还差一个大佬带我~" title="距离月入20k也就还差一个大佬带我~"><div id="runtimeTextTip"></div></div><div class="footer_custom_text"><a href="https://blogscn.fun/" title="BLOGS·CN" target="_blank"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://photo.xiangming.site/img/blogscn.png" alt="本站已加入BLOGS·CN" style="width:auto;height:15px"></a><a href="https://www.blogsclub.org/go" target="_blank" title="空间穿梭-随机访问BlogsClub成员博客"><img style="width:auto;height:22px" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://www.blogsclub.org/images/shuttle_3.png"></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="今日热榜" target="_blank" rel="noopener" href="https://hot.fantasyke.cn/">今日热榜</a><a class="footer-item" title="站点状态" target="_blank" rel="noopener" href="https://status.fantasyke.cn/">站点状态</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/policy/">隐私协议</a><a class="footer-item" title="版权协议" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2025 By <a class="footer-bar-link" href="/" title="Fantasy-ke" target="_blank">Fantasy-ke</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType(){fetch("https://v1.hitokoto.cn").then((t=>t.json())).then((t=>{{const e="出自 "+t.from,p=["既然选择远方，当不负青春，砥砺前行。","青春由磨砺而出彩，人生因奋斗而升华！","但行前路，不负韶华！","每一个裂缝都是为透出光而努力","美好的一天，上帝不会就这样给你，需要自己去创造。","你要做冲出的黑马 而不是坠落的星星。","纵然世间黑暗，仍有一点星光。","试一下，你会比你自己想象中的还要强大","眼里有不朽的光芒 心里有永恒的希望","等待的不仅仅是未来，还有希望…"];p.unshift(t.hitokoto,e),window.typed=new Typed("#footer-type-tips",{strings:p,startDelay:300,typeSpeed:150,loop:!0,backSpeed:50})}}))}"function"==typeof Typed?subtitleType():getScript("https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js").then(subtitleType)</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://fantasyke.cn" title="主页">主页</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="湘ICP备2025108771号">湘ICP备2025108771号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">84</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">40</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">11</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://fantasyke.cn/" title="主页"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="主页"><span class="back-menu-item-text">主页</span></a><a class="back-menu-item" href="https://blog.fantasyke.cn/" title="博客"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://filebed.fantasyke.cn/" title="图床"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="图床"><span class="back-menu-item-text">图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://hot.fantasyke.cn/" title="今日热榜"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="今日热榜"><span class="back-menu-item-text">今日热榜</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://music.fantasyke.cn/" title="音乐"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="音乐"><span class="back-menu-item-text">音乐</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://status.fantasyke.cn/" title="站点状态"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/logo/favicon.ico" alt="站点状态"><span class="back-menu-item-text">站点状态</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i> <span>时光卷轴</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i> <span>文章分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i> <span>文章标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa-solid fa-chart-pie faa-tada"></i> <span>文章通览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>社交</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i> <span>友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i> <span>留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa-solid fa-comments faa-tada faa-tada"></i> <span>评论</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i> <span>音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i> <span>碎碎念</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/sitenav/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>网站</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i> <span>关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/policy/"><i class="fa-solid fa-copyright faa-tada faa-tada"></i> <span>隐私策</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.fantasyke.cn"><i class="fa-solid fa-chart-simple faa-tada"></i> <span>站点统计</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"><a class="tag-list" href="/tags/Docker" title="Docker">Docker</a><a class="tag-list" href="/tags/ASP.NET%20Core" title="ASP.NET Core">ASP.NET Core</a><a class="tag-list" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="设计模式">设计模式</a><a class="tag-list" href="/tags/CQRS" title="CQRS">CQRS</a></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script async>!function(){var e,t,n,r,a,i=new Date("04/01/2022 00:00:00"),o=new Date;setInterval((()=>{!function(){o=new Date,a=o.getHours();var l=(o-i)/1e3/60/60/24;e=Math.floor(l);var u=(o-i)/1e3/60/60-24*e;t=Math.floor(u),1==String(t).length&&(t="0"+t);var d=(o-i)/1e3/60-1440*e-60*t;n=Math.floor(d),1==String(n).length&&(n="0"+n);var g=(o-i)/1e3-86400*e-3600*t-60*n;r=Math.round(g),1==String(r).length&&(r="0"+r)}(),function(){if(!document.getElementById("footer"))return;let i="";if(a<18&&a>=9)i=`本站居然运行了 ${e} 天<span id='runtime'> ${t} 小时 ${n} 分 ${r} 秒 </span>`;else{let a=document.querySelector("#workboard .workSituationImg");null!=a&&(a.src="https://filebed.fantasyke.cn/file/blogOther/xiaban.2a582djqe6.svg",a.title="下班了就该开开心心的玩耍，嘿嘿~",a.alt="下班了就该开开心心的玩耍，嘿嘿~"),i=`本站居然运行了 ${e} 天<span id='runtime'> ${t} 小时 ${n} 分 ${r} 秒 </span>`}document.getElementById("runtimeTextTip")&&(document.getElementById("runtimeTextTip").innerHTML=i)}()}),1e3)}()</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(()=>{const t=()=>{"object"==typeof twikoo?setTimeout(o,0):getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(o)},o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.fantasyke.cn",region:"",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))};t()})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener("load",(()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++){t+="<div class='aside-list-item'>";{const a="data-lazy-src";t+=`<a href='${e[n].url}' class='thumbnail'><img ${a}='${e[n].avatar}' alt='${e[n].nick}'><div class='name'><span>${e[n].nick} </span></div></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <time datetime="${e[n].date}">${anzhiyu.diffDate(e[n].date,!0)}</time></div>\n        </div>`}else t+="没有评论";let n=document.querySelector("#card-newest-comments .aside-list");n&&(n.innerHTML=t),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("twikoo-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{twikoo.getRecentComments({envId:"https://twikoo.fantasyke.cn",region:"",pageSize:6,includeReply:!0}).then((function(t){const n=t.map((e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()};var t}));saveToLocal.set("twikoo-newest-comments",JSON.stringify(n),10/1440),e(n)})).catch((function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"}))};"object"==typeof twikoo?t():getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)}))</script><script>var visitorMail="demo@fantasyke.cn"</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://lib.baomitu.com/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="/static/js/card-welcome.js"></script><script src="/static/js/countdown.js"></script><script src="/static/js/footer-animal.js"></script><script src="/static/js/comments.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!0,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","G-5N1WS0B6FJ",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%;margin-bottom: 15px;"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp" alt="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-12-24</span><a class="blog-slider__title" href="posts/6077dc15.html">在.NET Core中使用异步多线程消费</a><div class="blog-slider__text">处理大量数据是一个常见的需求，传统的同步处理方式往往效率低下，尤其是在数据量非常大的情况下。</div><a class="blog-slider__button" href="posts/6077dc15.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp" alt="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-26</span><a class="blog-slider__title" href="posts/fa354dcb.html">MediatR：轻松实现命令查询职责分离模式(CQRS)</a><div class="blog-slider__text"><li><a href="#一对一">一对一</a></li></div><a class="blog-slider__button" href="posts/fa354dcb.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp" alt="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-28</span><a class="blog-slider__title" href="posts/896e333f.html">gRPC in ASP.NET Core</a><div class="blog-slider__text"><li><a href="#消息类型的演进">消息类型的演进</a></li></div><a class="blog-slider__button" href="posts/896e333f.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp" alt="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-07-08</span><a class="blog-slider__title" href="posts/6c86af72.html">.NET Core使用Cap</a><div class="blog-slider__text"><li><a href="#准备工作">准备工作</a></li></div><a class="blog-slider__button" href="posts/6c86af72.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp" alt="https://filebed.fantasyke.cn/file/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-10-11</span><a class="blog-slider__title" href="posts/e5c315n.html">.NET Core中RabbitMQ初识</a><div class="blog-slider__text">前段时间上班无事，上网冲浪看到了消息队列RabbitMQ，就想着学习一下，网上看了点资料在哔哩哔哩上看的到codeman讲的一个rabbitmq的视频，就跟着仔细学习一下，敲一下</div><a class="blog-slider__button" href="posts/e5c315n.html">详情</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("已挂载swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"left",width:200,height:400},mobile:{show:!0},react:{opacity:.7},alg:"crc32",rep:"hex",drafts:!1,auto_category:{enable:!0,depth:null,over_write:!1},auto_title:!1,auto_date:!1,force:!1,log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html>