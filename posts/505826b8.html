<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Redis进阶 | Fantasy`Ke Blog</title><meta name="keywords" content="Redis,NOSQL"><meta name="author" content="Fantasy-ke"><meta name="copyright" content="Fantasy-ke"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Redis进阶"><meta name="application-name" content="Redis进阶"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Redis进阶"><meta property="og:url" content="https://blog.fantasyke.cn/posts/505826b8.html"><meta property="og:site_name" content="Fantasy`Ke Blog"><meta property="og:description" content=".NET Core操作Redis 持久化 持久化过程保存什么"><meta property="og:locale" content="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><meta property="og:image" content="https://picx.fantasyke.cn/wallpaper/4d5b121d880511ebb6edd017c2d2eca2.2ks0d4tx06.webp?_r_=e45edc1b-00c8-2dd9-a483-cc199172f011"><meta property="article:author" content="Fantasy-ke"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://picx.fantasyke.cn/wallpaper/4d5b121d880511ebb6edd017c2d2eca2.2ks0d4tx06.webp?_r_=e45edc1b-00c8-2dd9-a483-cc199172f011"><meta name="description" content=".NET Core操作Redis 持久化 持久化过程保存什么"><link rel="shortcut icon" href="https://picx.fantasyke.cn/logo/favicon.ico"><link rel="canonical" href="https://blog.fantasyke.cn/posts/505826b8.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//www.clarity.ms"><meta name="google-site-verification" content="0qBBGdG7vYORyT5XLZRUqQZ_y5kKYhgyUwNqjSIImg0"><meta name="algolia-site-verification" content="4C7825663F86ADB3"><meta name="baidu-site-verification" content="codeva-P64BkuHkDm"><meta name="msvalidate.01" content="63C90D0EC3DA6C31FD109132B7BEF502"><script async defer src="https://umami.fantasyke.cn/script.js" data-website-id="b57cd87f-e343-49ac-b443-6f8f4f309f84"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload='this.media="all"'><script async src="https://www.googletagmanager.com/gtag/js?id=G-5N1WS0B6FJ"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-5N1WS0B6FJ")</script><script>!function(e,t,c,n,a,r,s){e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},(r=t.createElement(n)).async=1,r.src="https://www.clarity.ms/tag/qfb52xcecl",(s=t.getElementsByTagName(n)[0]).parentNode.insertBefore(r,s)}(window,document,"clarity","script")</script><script>const GLOBAL_CONFIG={linkPageTop:{enable:!0,title:"与数百名博主无限进步",addFriendPlaceholder:"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"Fantasy",mode:"fantasy",switchBtn:!1,btnLink:"https://afdian.net/item/886a79d4db6711eda42a52540025c377",randomNum:3,basicWordCount:1e3,key:"xxxx",Referer:"https://xx.xx/"},diytitle:{enable:!0,leaveTitle:"(∪.∪ )...zzz",backTitle:"♪(´▽｀)"},LA51:void 0,greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 宝贝",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.fantasyke.cn",commentBarrageConfig:{enable:!0,maxBarrage:1,barrageTime:8e3,accessToken:"0ca6db2a330bbffcb0d254a061dbd00e",mailMd5:"F6CBE561768BA13B8E01135BF4767C8D"},music_page_default:"nav_music",root:"/",preloader:{source:3},friends_vue_info:void 0,navMusic:!0,mainTone:void 0,authorStatus:{skills:["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},algolia:{appId:"G44M1T5X02",apiKey:"417e6420e5de4c61138e56634ac44fa0",indexName:"fantasy_blog",hits:{per_page:6},languages:{input_placeholder:"输入关键词后按下回车查找",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"它已经",messageNext:"自上次更新以来的天数，文章的内容可能已过时。"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!1,limitCount:50,languages:{author:"作者: Fantasy-ke",link:"链接: ",source:"来源: Fantasy`Ke Blog",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,shortcutKey:{enable:!0,delay:100,shiftDelay:200},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"Fantasy`Ke Blog",title:"Redis进阶",postAI:"true",pageFillDescription:".NET Core操作Redis, 持久化, 持久化过程保存什么, RDB, RDB持久化的配置, 注意, bgsave, 自动执行RDB, 自动执行RDB注意, 三种方案对比, RDB特殊启动形式, RDB优点, RDB缺点, AOF, RDB存储的弊端, 解决思路, 概念, AOF写数据三种策略(appendfsync), AOF配置, AOF重写, AOF重写作用, AOF重写规则, AOF重写方式, AOF自动重写方式, AOF非重写流程, AOF重写流程, RDB与AOF区别, RDB与AOF怎么选, 事务, 简介, 基本操作, 事务的工作流程, 事务的注意事项, 锁 – 基于特定条件的事务执行, 乐观锁, 业务分析, 解决方案, 分布式锁, 业务分析, 解决方案, 死锁, 业务分析, 解决方案, 删除策略, Redis中的数据特征, 定时删除, 惰性删除, 定期删除, 删除策略比对, 逐出算法, 新数据进入检测, 影响数据逐出的相关设置, 数据逐出策略配置依据, Redis.Conf, 服务器基础配置, 日志配置, 客户端配置, 多服务器快捷配置, 高级数据类型, Bitmaps, HyperLogLog, 说明, GEO, 基本操作操作创建控制台应用通过引入具体示例代码如下张三持久化持久化利用永久性存储介质将数据进行保存在特定的时间将保存的数据进行恢复的工作机制为什么要持久化防止数据的意外丢失确保数据安全持久化过程保存什么将当前数据状态进行保存快照形式存储数据结果存储格式简单关注点在数据将数据的操作过程进行保存日志形式存储操作过程存储格式复杂关注点在数据的操作过程操作命令作用手动执行一次保存操作持久化的配置在配置文件中修改说明设置本地数据库文件名默认为经验通常设置为端口号说明设置存储文件的路径经验通常设置成存储空间较大的目录中目录名称说明设置存储至本地数据库时是否压缩数据默认为采用压缩经验通常默认为开启状态如果设置为可以节省运行时间但会使存储的文件变大巨大说明设置是否进行文件格式校验该校验过程在写文件和读文件过程均进行经验通常默认为开启状态如果设置为可以节约读写行过程约时间消耗但是存储一定的数据损坏风险说明后台存储过程中如果出现错误现象是否停止保存操作这个配置项针对操作经验通常默认为开启状态注意指令的执行会阻塞当前服务器知道当前过程完成位置有可能会造成长时间阻塞线上环境不建议使用操作命令作用手动启动后台保存操作但不是立即执行注意命令是针对阻塞问题做的优化内部所有涉及到操作都采用的方式命令可以放弃使用自动执行配置作用满足限定时间范围内的变化数量达到指定数量即进行持久化参数监控时间范围监控的变化量位置在文件中进行配置示例秒内变化个即触发秒内变化个即触发秒内变化个即触发经验一般监控时间大变化时间小自动执行注意配置要根据实际业务情况进行设置频度过高或过低都会出现性能问题结果可能是灾难性的配置中对于与设置通常具有互补对应关系尽量不要设置成包含行关系配置启动后执行的是操作三种方案对比方式指令指令配置读写同步异步阻塞客户端指令是否额外内存消耗否是启动新进程否是特殊启动形式全量复制主从复制再说服务器运行过程中重启关闭服务器时指定保存数据优点是一个紧凑压缩的二进制文件存储效率较高内部存储的是在某个时间点的数据快照非常适合用于数据备份全量复制等场景恢复数据的速度要比快很多应用服务器中每小时执行备份并将文件拷贝到远程服务器中用于灾难恢复缺点方式无论是执行指令还是利用配置无法做到实时持久化具有较大的可能性丢失数据指令每次运行要执行操作创建子进程要牺牲掉一些性能的众多版本中未进行文件格式的版本统一有可能出现各版本服务之间数据格式无法兼容现象存储的弊端存储数据量较大效率较低基于快照思想每次读写都是全部数据当数据量巨大时效率非常低大数据量下的性能较低基于创建子进程内存产生额外消耗宕机带来的数据丢失风险解决思路不写全数据仅记录部分数据改记录数据为记录操作过程对所有数据操作均进行记录排除丢失数据的风险概念持久化以独立日志的方式记录每次写命令重启时再重新执行文件中命令以达到恢复数据的目的与相比可以简单描述为改记录数据为记录数据产生的过程的主要作用是解决了数据持久化的实时性目前已经是持久化的主流方式写数据三种策略每次每次写入操作均同步到文件中数据零误差性能较差每秒每秒将缓冲区的指令同步到文件中数据准确性较高性能较高在系统突然宕机的情况下丢失秒内的数据建议使用也是默认配置项系统控制由操作系统控制每次同步到文件的周期整体过程不可控配置配置作用是否开启持久化功能默认为不开启状态经验开启配置作用写数据策略经验配置作用持久化文件名默认文件名为经验建议配置为端口号配置作用持久化文件保存路径经验与持久化文件保持一致即可重写随着命令不断写入文件会越来越大为了解决这个问题引入了重写机制压缩文件体积文件重写是将进程内的数据转化为些命令同步到新文件的过程简单说就是将对同一个数据的若干条命令执行结果转化成最终结果数据对应的指令进行记录重写作用降低磁盘占用量提高磁盘利用率提高持久化效率降低持久化写时间提升性能降低数据恢复用时提高数据恢复效率重写规则进程内已超时的数据不再写入文件忽略无效指令重写时使用进程内数据直接生成这样新的文件只保留最终数据的写入命令如对同一数据的多条写命令合并为同一条命令如可以转为为了防止数据量过大造成客户端缓冲区溢出对等类型每条指令最多写入个元素重写方式手动重写自动重写自动重写方式自动重写触发条件设置自动的重写尺寸默认值比较大自动重写的百分比自动重写触发对比参数运行指令获取具体信息自动重写触发条件非重写流程重写流程与区别持久方式占用存储空间小数据级压缩大指令集重写存储速度慢快恢复速度快慢数据安全性会丢失数据依据策略决定消耗资源高重量级低轻量级启动优先级低高与怎么选对数据非常敏感建议使用默认的持久化方案持久化策略使用每秒钟一次该策略仍然可以保持很好的性能当出现问题时最多丢失秒钟的数据注意文件存储体积较大且恢复速度较慢数据呈现具有有效性建议使用持久化方案数据可以良好的做到阶段内无丢失该阶段是开发者或运维人员手工维护的且恢复速度快阶段点数据恢复通常采用方案注意利用实现紧凑的数据持久化会使性能降得很低综合比对与的选择实际上是在做一种权衡每种都有利弊如不能承受数分钟以内的数据丢失对业务数据非常敏感选用如能承受数分钟以内的数据丢失且追求大数据的恢复速度选用灾难恢复选用双保险策略同时开启和重启后优先使用来恢复数据降低丢失数据的量事务简介为什么要有事务执行指令过程中多条连续执行的指令被干扰打断插队事务就是一个命令执行的队列将一系列预定义命令包装成一个整体一个队列当执行时一次性按照添加顺序依次执行中间不会被打断或干扰一个队伍中一次性顺序性排他性的执行一系列命令基本操作开启事务作用设定事务的开启位置此指令执行后后续的所有指令均加入到事务中执行事务作用设定事务的结束位置同时执行事务与成对出现成对使用取消事务作用终止当前事务的定义发生在之后之前注意加入事务的命令暂时进入到任务队列中并没有立即执行只有执行命令才开始执行事务的工作流程事务的注意事项定义事务的过程中命令格式输入错误怎么办语法错误指命令书写格式有误处理结果如果定义的事务中所包含存在语法错误整体事务中所有命令均不会执行包括那些语法正确的命令定义事务的过程中命令执行出现错误怎么办运行错误指命令格式正确但是无法正确的执行例如对进行操作处理结果能够正确运行的命令会执行运行错误的命令不会执行注意已经执行的命令对应的数据不会自动回滚需要程序员自己在代码中实现回滚手动进行事务回滚无奈之举才用记录操作过程中被影响的数据之前的状态单数据多数据设置指令恢复所有的被修改的项单数据直接注意周边属性例如时效多数据修改对应值或整体克隆复制锁基于特定条件的事务执行乐观锁业务分析多个客户端都有可能同时操作同一组数据并且该数据一旦被操作修改后将不适用于继续操作在操作之前锁定要操作的数据一旦发生变化终止当前操作解决方案对添加监视锁在执行前如果发生了变化终止事务执行取消对所有的监视命令在事务开启之前然后在执行事务的的时候会判断的值是否已经发生变化如果没有则正常事务执行如果发生了变化则操作的命令失败分布式锁业务分析使用监控一个有没有改变已经不能解决问题此处要监控的是具体数据虽然是单线程但是多个客户对同一个数据同时进行操作时如何避免不被同时修改解决方案设置设置一个公共锁利用命令的返回值特征有值则返回设置失败无值则返回设置成功对于返回设置成功的拥有控制权进行下一步的具体业务操作对于返回设置失败的不具有控制权排队或等待操作完毕通过操作释放锁死锁业务分析由于锁操作由用户控制加锁解锁必定会存在加所有未解锁的风险需要解锁操作不能仅依赖用户控制系统级别要能给出对应的保底处理方案解决方案使用为锁添加时间限定到时不释放锁放弃锁由于操作通常都是微妙或毫秒级因此该锁定时间不宜设置过长具体时间需要业务测试后确定例如持有锁的操作最长执行时间最短执行时间测试百万次最长执行时间对应命令的最大耗时测试百万次网络延迟平均耗时锁时间设定推荐最大耗时平均网络延迟如果业务最大耗时网络平均耗时通常为个数量级取其中单个耗时较长即可删除策略中的数据特征是一种内存及数据库所有数据均存放在内存中内存中的数据可以通过指令获取其状态具有时效性的数据永久有效的数据已经过期的数据或被删除的数据或未定义的数据数据删除策略的目的在内存占用与占用之间寻找一种平衡顾此失彼都会造成整体性能的下降甚至引发服务器宕机或内存泄露定时删除创建一个定时器当设置由过期时间且过期时间到达时由定时器立即执行对键的删除操作优点解决内存到时就删除快速释放掉不必要的内存占用缺点压力很大无论此时负载量多高均占用会影响服务器响应时间和指令吞吐量总结用处理器性能换存储空间拿时间换空间惰性删除数据到达过期时间不做处理等下次访问该数据时再进行删除并返回不存在优点节约性能发现必须删除的时候才删除缺点内存压力很大出现长期占用内存的数据总结用存储空间换取处理器性能拿空间换时间定期删除启动服务器初始化时读取配置的值默认为每秒执行次对每个逐一进行检测每次执行对某个检测时随机挑选个检测如果超时删除如果一轮中删除的的数量则循环该过程如果一轮中删除的的数量检查下一个循环取值属性值参数用来记录进入那个执行周期性轮询库中的时效性数据采用随机抽取的策略利用过期数据占比的方式控制删除频度特点性能占用设置由峰值检测频度可自定义设置特点内存压力不是很大长期占用内存的冷数据会被持续清理总结周期性抽查检查空间随机抽查重点抽查删除策略比对删除策略特点特点总结定期删除节约内存无占用部分时段占用资源频度高拿时间换空间惰性删除内存占用严重延时执行利用率高拿空间换时间定期删除内存定期随机清理每秒花费固定的资源维护内存随机抽查重点抽查逐出算法新数据进入检测当新数据进入时如果内存不足怎么办使用内存存储数据在执行每一个命令前会调用检测内存是否充足如果内存不满足新加入数据的最低存储要求要临时删除一些数据为当前指令清除存储空间清理数据的策略称为逐出算法注意逐出算法的过程不是能够清理出足够的可使用的内存空间如果不成功则反复执行当对所有数据尝试完毕后如果不能达到内存清理的要求将出现错误信息影响数据逐出的相关设置最大可使用内存占用物理内存的比例默认值为表示不限制生产环境中根据需求设定通常设置在以上每次选取待删除数据的个数选取数据时并不会全库扫描导致严重的性能消耗降低读写性能因此采用随机获取数据的方式作为待检测删除数据删除策略达到最大内存后的对被挑选出来的数据进行删除的策略检测易失数据可能会过期的数据集挑选最近最少使用的数据淘汰推荐挑选最近使用次数最少的数据淘汰挑选将要过期的数据淘汰任意选择数据淘汰检测全库数据所有数据集挑选最近最少使用的数据淘汰挑选最近使用次数最少的数据淘汰任意选择数据淘汰不使用数据驱逐不驱逐禁止驱逐数据中默认策略会引发错误配置方式数据逐出策略配置依据使用命令输出监控信息查询缓存和的次数根据业务需求调优配置服务器基础配置设置服务器以守护进程的方式运行绑定主机地址设置服务器端口号设置数据库数量日志配置设置服务器以指定日志记录级别日志记录文件名端口号注意日志级别开发期设置为生产环境中配置为简化日志输出量降低写日志的频度客户端配置设置同一时间最大客户端连接数默认无限制当客户端连接到达上限会关闭新的连接客户端限制等待最长时长达到最大值后关闭连接如需要关闭该功能设置为多服务器快捷配置导入并加载指定配置文件信息用于快速创建公共配置较多的实例配置文件便于维护端口号高级数据类型获取指定对应偏移量上的值设置指定对应偏移量上的值只能时或对指定按位进行交并非异或操作并将结果保存到中交并非异或统计指定中的数量基数数据集去重后元素个数是用来做基数统计的运用了的算法添加数据统计数据合并数据说明只用于进行基数统计不是集合不保存数据只记录数量而不是具体数量核心是基数估计算法最终数值存在一定误差误差范围基数估计的结果是一个带有标准错误的近似值耗空间极小每个占用了的内存用于标记基数命令不是一次性分配内存使用会随着基数的增加内存主键增大命令合并后占用的存储空间为无论合并之前数据量多大存放地理位置的数据类型基本操作添加坐标点获取坐标点计算坐标点距离是单位米千米根据坐标求范围内的数据根据点求范围内的数据获取指定点对应的坐标值",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-05-30 12:08:00",postMainColor:""}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{if(0===a)return;const o={value:t,expiry:Date.now()+864e5*a};localStorage.setItem(e,JSON.stringify(o))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const a=JSON.parse(t);if(!(Date.now()>a.expiry))return a.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise(((a,o)=>{const c=document.createElement("script");c.src=e,c.async=!0,c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},Object.keys(t).forEach((e=>{c.setAttribute(e,t[e])})),document.head.appendChild(c)})),e.getCSS=(e,t=!1)=>new Promise(((a,o)=>{const c=document.createElement("link");c.rel="stylesheet",c.href=e,t&&(c.id=t),c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},document.head.appendChild(c)})),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};const t=saveToLocal.get("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,o=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!a&&!o&&!c;if(void 0===t){if(o)activateLightMode();else if(a)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=6||e>=18?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener((e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())}))}else"light"===t?activateLightMode():activateDarkMode();const d=saveToLocal.get("aside-status");void 0!==d&&("hide"===d?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/static/main-style.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/mainColor/heoMainColor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/poem.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/static/images/avatar.png"><div class="loading-image-dot"></div></div></div><script>const preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",(()=>{preloader.endLoading()})),setTimeout((function(){preloader.endLoading()}),1e4),document.addEventListener("pjax:send",(()=>{preloader.initLoading()})),document.addEventListener("pjax:complete",(()=>{preloader.endLoading()}))</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://fantasyke.cn/" title="主页"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="主页"><span class="back-menu-item-text">主页</span></a><a class="back-menu-item" href="https://blog.fantasyke.cn/" title="博客"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://imgbed.fantasyke.cn/" title="图床"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="图床"><span class="back-menu-item-text">图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://hot.fantasyke.cn/" title="今日热榜"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="今日热榜"><span class="back-menu-item-text">今日热榜</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://music.fantasyke.cn/" title="音乐"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="音乐"><span class="back-menu-item-text">音乐</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://status.fantasyke.cn/" title="站点状态"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="站点状态"><span class="back-menu-item-text">站点状态</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Fantasy`Ke Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET={CONFIG:{modules:"0124",background:"2",tmpColor:"FFFFFF",tmpSize:"16",cityColor:"FFFFFF",citySize:"16",aqiColor:"E8D87B",aqiSize:"16",weatherIconSize:"24",alertIconSize:"18",padding:"10px 10px 10px 10px",shadow:"0",language:"auto",borderRadius:"20",fixed:"true",vertical:"top",horizontal:"left",left:"20",top:"7.1",key:"df245676fb434a0691ead1c63341cd94"}}</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i> <span>时光卷轴</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i> <span>文章分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i> <span>文章标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa-solid fa-chart-pie faa-tada"></i> <span>文章通览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>社交</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i> <span>友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i> <span>留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa-solid fa-comments faa-tada faa-tada"></i> <span>评论</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i> <span>音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i> <span>碎碎念</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/sitenav/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>网站</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i> <span>关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/policy/"><i class="fa-solid fa-copyright faa-tada faa-tada"></i> <span>隐私策</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.fantasyke.cn"><i class="fa-solid fa-chart-simple faa-tada"></i> <span>站点统计</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i> <span>搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://picx.fantasyke.cn/qrcode/qrcode-weichat.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/qrcode/qrcode-weichat.jpg"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://picx.fantasyke.cn/qrcode/qrcode-alipay.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/qrcode/qrcode-alipay.jpg"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/NET-Core/" style="font-size:1.05rem">.NET Core<sup>3</sup></a><a href="/tags/ASP-NET-Core/" style="font-size:1.05rem">ASP.NET Core<sup>4</sup></a><a href="/tags/C/" style="font-size:1.05rem">C#<sup>12</sup></a><a href="/tags/CAP/" style="font-size:1.05rem">CAP<sup>1</sup></a><a href="/tags/CQRS/" style="font-size:1.05rem">CQRS<sup>1</sup></a><a href="/tags/DDD/" style="font-size:1.05rem">DDD<sup>1</sup></a><a href="/tags/Docker/" style="font-size:1.05rem">Docker<sup>10</sup></a><a href="/tags/Docker-Swarm/" style="font-size:1.05rem">Docker-Swarm<sup>2</sup></a><a href="/tags/EntityFramework-Core/" style="font-size:1.05rem">EntityFramework Core<sup>1</sup></a><a href="/tags/Git/" style="font-size:1.05rem">Git<sup>1</sup></a><a href="/tags/JWT/" style="font-size:1.05rem">JWT<sup>1</sup></a><a href="/tags/MediatR/" style="font-size:1.05rem">MediatR<sup>1</sup></a><a href="/tags/Middleware/" style="font-size:1.05rem">Middleware<sup>1</sup></a><a href="/tags/MongoDB/" style="font-size:1.05rem">MongoDB<sup>1</sup></a><a href="/tags/Mysql/" style="font-size:1.05rem">Mysql<sup>1</sup></a><a href="/tags/NOSQL/" style="font-size:1.05rem">NOSQL<sup>4</sup></a><a href="/tags/ORM/" style="font-size:1.05rem">ORM<sup>1</sup></a><a href="/tags/RabbitMQ/" style="font-size:1.05rem">RabbitMQ<sup>3</sup></a><a href="/tags/Redis/" style="font-size:1.05rem">Redis<sup>4</sup></a><a href="/tags/SQL-Server/" style="font-size:1.05rem">SQL Server<sup>1</sup></a><a href="/tags/Ubuntu/" style="font-size:1.05rem">Ubuntu<sup>1</sup></a><a href="/tags/docker/" style="font-size:1.05rem">docker<sup>1</sup></a><a href="/tags/gRPC/" style="font-size:1.05rem">gRPC<sup>1</sup></a><a href="/tags/gitlab/" style="font-size:1.05rem">gitlab<sup>1</sup></a><a href="/tags/hexo/" style="font-size:1.05rem">hexo<sup>1</sup></a><a href="/tags/life/" style="font-size:1.05rem">life<sup>1</sup></a><a href="/tags/nginx/" style="font-size:1.05rem">nginx<sup>1</sup></a><a href="/tags/notion/" style="font-size:1.05rem">notion<sup>2</sup></a><a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size:1.05rem">事务<sup>1</sup></a><a href="/tags/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/" style="font-size:1.05rem">人生感悟<sup>1</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size:1.05rem">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size:1.05rem">并发编程<sup>2</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E6%96%B9%E6%A1%88/" style="font-size:1.05rem">开发方案<sup>2</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size:1.05rem">消息队列<sup>3</sup></a><a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size:1.05rem">版本控制<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/" style="font-size:1.05rem">编程思想<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size:1.05rem">网络配置<sup>2</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size:1.05rem">设计模式<sup>25</sup></a><a href="/tags/%E9%80%9A%E8%AE%AF/" style="font-size:1.05rem">通讯<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size:1.05rem">面试题<sup>3</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"><i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E7%A0%96/" itemprop="url">杂七杂八的砖</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Redis/" tabindex="-1" itemprop="url"><span><i class="anzhiyufont anzhiyu-icon-hashtag"></i> Redis</span></a><a class="article-meta__tags" href="/tags/NOSQL/" tabindex="-1" itemprop="url"><span><i class="anzhiyufont anzhiyu-icon-hashtag"></i> NOSQL</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Redis进阶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-05-30T12:08:00.000Z" title="发表于 2023-05-30 12:08:00">2023-05-30</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-05-30T12:08:00.000Z" title="更新于 2023-05-30 12:08:00">2023-05-30</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.8k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-position" title="作者IP属地为广州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i> 广州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://picx.fantasyke.cn/wallpaper/4d5b121d880511ebb6edd017c2d2eca2.2ks0d4tx06.webp?_r_=e45edc1b-00c8-2dd9-a483-cc199172f011"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">FantasyGPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://blog.fantasyke.cn/posts/505826b8.html"><header><a class="post-meta-categories" href="/categories/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E7%A0%96/" itemprop="url">杂七杂八的砖</a><a href="/tags/Redis/" tabindex="-1" itemprop="url">Redis</a><a href="/tags/NOSQL/" tabindex="-1" itemprop="url">NOSQL</a><h1 id="CrawlerTitle" itemprop="name headline">Redis进阶</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Fantasy-ke</span><time itemprop="dateCreated datePublished" datetime="2023-05-30T12:08:00.000Z" title="发表于 2023-05-30 12:08:00">2023-05-30</time><time itemprop="dateCreated datePublished" datetime="2023-05-30T12:08:00.000Z" title="更新于 2023-05-30 12:08:00">2023-05-30</time></header><span id="more"></span><h1 id="NET-Core操作Redis"><a href="#NET-Core操作Redis" class="headerlink" title=".NET Core操作Redis"></a>.NET Core操作Redis</h1><p>创建控制台应用<code>RedisSample01</code>，通过<code>nuget</code>引入<code>CSRedisCore</code></p><p>具体示例代码如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">using System;  </span><br><span class="line">using System.Linq;  </span><br><span class="line">using System.Threading.Tasks;  </span><br><span class="line">using CSRedis;  </span><br><span class="line">  </span><br><span class="line">namespace RedisSample01  </span><br><span class="line">&#123;  </span><br><span class="line">    class Program  </span><br><span class="line">    &#123;  </span><br><span class="line">        static async Task Main(string\[\] args)  </span><br><span class="line">        &#123;  </span><br><span class="line">        </span><br><span class="line">        var redis = new CSRedisClient(<span class="string">&quot;127.0.0.1:6379,defaultDatabase=0,prefix=ds_&quot;</span>);  </span><br><span class="line">        RedisHelper.Initialization(redis);  </span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;↓↓↓↓↓ String Sample ↓↓↓↓↓&quot;</span>);  </span><br><span class="line">        await RedisHelper.SetAsync(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;dimsum&quot;</span>);  </span><br><span class="line">        var name = await RedisHelper.GetAsync&lt;string&gt;(<span class="string">&quot;name&quot;</span>);  </span><br><span class="line">        Console.WriteLine($<span class="string">&quot;name = &#123;name&#125;&quot;</span>);  </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;↑↑↑↑↑ Sample End ↑↑↑↑↑↑&quot;</span>);  </span><br><span class="line">        Console.WriteLine();  </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;↓↓↓↓↓ List Sample ↓↓↓↓↓&quot;</span>);  </span><br><span class="line">        await RedisHelper.DelAsync(<span class="string">&quot;list1&quot;</span>);  </span><br><span class="line">        await RedisHelper.LPushAsync(<span class="string">&quot;list1&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);  </span><br><span class="line">        await RedisHelper.RPushAsync(<span class="string">&quot;list1&quot;</span>, <span class="string">&quot;x&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        var list1 =await RedisHelper.LRangeAsync(<span class="string">&quot;list1&quot;</span>, 0, -1);  </span><br><span class="line">        Console.WriteLine($<span class="string">&quot;list1 = &#123;String.Join(&#x27;,&#x27;,list1)&#125;&quot;</span>);  </span><br><span class="line">        var list1Length = await redis.LLenAsync(<span class="string">&quot;list1&quot;</span>);  </span><br><span class="line">        Console.WriteLine($<span class="string">&quot;list1.length = &#123;list1Length&#125;&quot;</span>);  </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;↑↑↑↑↑ Sample End ↑↑↑↑↑↑&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;↓↓↓↓↓ Hash Sample ↓↓↓↓↓&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        await RedisHelper.HSetAsync(<span class="string">&quot;hash1&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);  </span><br><span class="line">        await RedisHelper.HSetAsync(<span class="string">&quot;hash1&quot;</span>, <span class="string">&quot;age&quot;</span>, 19);  </span><br><span class="line">        await RedisHelper.HSetAsync(<span class="string">&quot;hash1&quot;</span>, <span class="string">&quot;job&quot;</span>, <span class="string">&quot;C#&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        var hash1 = await RedisHelper.HGetAllAsync(<span class="string">&quot;hash1&quot;</span>);  </span><br><span class="line">        Console.WriteLine($<span class="string">&quot;hash1 = &#123;string.Join(&#x27;,&#x27;, hash1.Select(x =&gt; $&quot;</span>&#123;x.Key&#125;:&#123;x.Value&#125;<span class="string">&quot;).ToArray())&#125;&quot;</span>);  </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;↑↑↑↑↑ Sample End ↑↑↑↑↑↑&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        Console.WriteLine();  </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;====================&quot;</span>);  </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Sample done&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><h1 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h1><ul><li>持久化：利用永久性存储介质将数据进行保存，在特定的时间将保存的数据进行恢复的工作机制</li><li>为什么要持久化？防止数据的意外丢失，确保数据安全</li></ul><h2 id="持久化过程保存什么"><a href="#持久化过程保存什么" class="headerlink" title="持久化过程保存什么"></a>持久化过程保存什么</h2><ul><li>RDB：将当前数据状态进行保存，快照形式，存储数据结果，存储格式简单，关注点在数据</li><li>AOF：将数据的操作过程进行保存，日志形式，存储操作过程，存储格式复杂，关注点在数据的操作过程</li></ul><h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><ul><li>操作命令：<code>save</code></li><li>作用：手动执行一次保存操作</li></ul><h3 id="RDB持久化的配置"><a href="#RDB持久化的配置" class="headerlink" title="RDB持久化的配置"></a>RDB持久化的配置</h3><p><strong>在配置文件中修改</strong></p><ul><li><p>dbfilename dump.rdb</p><ul><li>说明：设置本地数据库文件名，默认为<code>dump.rdb</code></li><li>经验：通常设置为<code>dump-端口号.rdb</code></li></ul></li><li><p>dir</p><ul><li>说明：设置存储<code>.rdb</code>文件的路径</li><li>经验：通常设置成存储空间较大的目录中，目录名称<code>data</code></li></ul></li><li><p>rdbcompression yes</p><ul><li>说明：设置存储至本地数据库时是否压缩数据，默认为<code>yes</code>，采用<code>LZF</code>压缩</li><li>经验：通常默认为开启状态，如果设置为<code>no</code>，可以节省CPU运行时间，但会使存储的文件变大(巨大)</li></ul></li><li><p>rdbchecksum yes</p><ul><li>说明：设置是否进行<code>RDB</code>文件格式校验，该校验过程在写文件和读文件过程均进行</li><li>经验：通常默认为开启状态，如果设置为no，可以节约读写行过程约10%时间消耗，但是存储一定的数据损坏风险</li></ul></li><li><p>stop-writes-on-bgsave-error yes</p><ul><li><p>说明：后台存储过程中如果出现错误现象，是否停止保存操作(这个配置项针对bgsave操作)</p></li><li><p>经验：通常默认为开启状态</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3></li></ul></li><li><p><em>save指令的执行会阻塞当前Redis服务器，知道当前RDB过程完成位置，有可能会造成长时间阻塞，线上环境不建议使用*</em></p><h3 id="bgsave"><a href="#bgsave" class="headerlink" title="bgsave"></a>bgsave</h3></li><li><p>操作命令：<code>bgsave</code></p></li><li><p>作用：手动启动后台保存操作，但不是立即执行</p></li></ul><p><strong>注意：bgsave命令是针对save阻塞问题做的优化，redis内部所有涉及到RDB操作都采用bgsave的方式，save命令可以放弃使用</strong><br><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/redis/image.3nrn361nc4.webp" alt="bgsave.png"></p><h3 id="自动执行RDB"><a href="#自动执行RDB" class="headerlink" title="自动执行RDB"></a>自动执行RDB</h3><ul><li>配置：<code>save second changes</code></li><li>作用：满足限定时间范围内key的变化数量达到指定数量，即进行持久化</li><li>参数：<ul><li>second：监控时间范围</li><li>changes：监控<code>key</code>的变化量</li></ul></li><li>位置：在conf文件中进行配置</li><li>示例：<ul><li><code>save 900 1</code> -&gt; 900秒内变化1个即触发RDB</li><li><code>save 300 10</code> -&gt; 300秒内变化10个即触发RDB</li><li><code>save 60 10000</code> -&gt; 60秒内变化10000个即触发RDB</li></ul></li><li>经验：一般监控时间大，变化时间小</li></ul><h3 id="自动执行RDB注意"><a href="#自动执行RDB注意" class="headerlink" title="自动执行RDB注意"></a>自动执行RDB注意</h3><ul><li><code>save</code>配置要根据实际业务情况进行设置，频度过高或过低都会出现性能问题，结果可能是灾难性的</li><li><code>save</code>配置中对于<code>second</code>与<code>changes</code>设置通常具有互补对应关系，尽量不要设置成包含行关系</li><li><code>save</code>配置启动后执行的是<code>bgsave</code>操作</li></ul><h3 id="三种方案对比"><a href="#三种方案对比" class="headerlink" title="三种方案对比"></a>三种方案对比</h3><table><thead><tr><th>方式</th><th>save指令</th><th>bgsave指令</th><th>save配置</th></tr></thead><tbody><tr><td>读写</td><td>同步</td><td>异步</td><td>阻塞客户端指令</td></tr><tr><td>是</td><td>否</td><td>额外内存消耗</td><td>否</td></tr><tr><td>是</td><td>启动新进程</td><td>否</td><td>是</td></tr></tbody></table><h3 id="RDB特殊启动形式"><a href="#RDB特殊启动形式" class="headerlink" title="RDB特殊启动形式"></a>RDB特殊启动形式</h3><ul><li>全量复制：（主从复制再说）</li><li>服务器运行过程中重启：<code>debug reload</code></li><li>关闭服务器时指定保存数据：<code>shutdown save</code></li></ul><h3 id="RDB优点"><a href="#RDB优点" class="headerlink" title="RDB优点"></a>RDB优点</h3><ul><li><code>RDB</code>是一个紧凑压缩的二进制文件，存储效率较高</li><li><code>RDB</code>内部存储的是redis在某个时间点的数据快照，非常适合用于数据备份，全量复制等场景</li><li><code>RDB</code>恢复数据的速度要比<code>AOF</code>快很多</li><li>应用：服务器中每N小时执行<code>bgsave</code>备份，并将<code>RDB</code>文件拷贝到远程服务器中，用于灾难恢复</li></ul><h3 id="RDB缺点"><a href="#RDB缺点" class="headerlink" title="RDB缺点"></a>RDB缺点</h3><ul><li><code>RDB</code>方式无论是执行指令还是利用配置，无法做到实时持久化，具有较大的可能性丢失数据</li><li><code>bgsave</code>指令每次运行要执行<code>fork</code>操作创建子进程，要牺牲掉一些性能</li><li><code>Redis</code>的众多版本中未进行<code>RDB</code>文件格式的版本统一，有可能出现各版本服务之间数据格式无法兼容现象</li></ul><h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><h3 id="RDB存储的弊端"><a href="#RDB存储的弊端" class="headerlink" title="RDB存储的弊端"></a>RDB存储的弊端</h3><ul><li><p>存储数据量较大，效率较低。基于快照思想，每次读写都是全部数据，当数据量巨大时，效率非常低</p></li><li><p>大数据量下的IO性能较低</p></li><li><p>基于<code>fork</code>创建子进程，内存产生额外消耗</p></li><li><p>宕机带来的数据丢失风险</p><h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h3></li><li><p>不写全数据，仅记录部分数据</p></li><li><p>改记录数据为记录操作过程</p></li><li><p>对所有数据操作均进行记录，排除丢失数据的风险</p></li></ul><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul><li>AOP(append only file)持久化：以独立日志的方式记录每次写命令，重启时再重新执行<code>AOF</code>文件中命令，以达到恢复数据的目的，与<code>RDB</code>相比可以简单描述为<strong>改记录数据为记录数据产生的过程</strong></li><li><code>AOF</code>的主要作用是解决了数据持久化的实时性，目前已经是<code>Redis</code>持久化的主流方式</li></ul><p><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/redis/image.491apgw8io.webp" alt="image.png"></p><h3 id="AOF写数据三种策略-appendfsync"><a href="#AOF写数据三种策略-appendfsync" class="headerlink" title="AOF写数据三种策略(appendfsync)"></a>AOF写数据三种策略(appendfsync)</h3><ul><li>always(每次)：每次写入操作均同步到<code>AOF</code>文件中，数据零误差，性能较差</li><li>everysec(每秒)：每秒将缓冲区的指令同步到<code>AOF</code>文件中，数据准确性较高，性能较高，在系统突然宕机的情况下丢失1秒内的数据。<strong>建议使用，也是默认配置项</strong></li><li>no(系统控制)：由操作系统控制每次同步到<code>AOF</code>文件的周期，整体过程不可控</li></ul><h3 id="AOF配置"><a href="#AOF配置" class="headerlink" title="AOF配置"></a>AOF配置</h3><ul><li>配置：<code>appendonly yes|no</code><ul><li>作用：是否开启<code>AOF</code>持久化功能，默认为不开启状态</li><li>经验：开启</li></ul></li><li>配置：<code>appendfsync always|everysec|no</code><ul><li>作用：<code>AOF</code>写数据策略</li><li>经验：<code>everysec</code></li></ul></li><li>配置：<code>appendfilename filename</code><ul><li>作用：<code>AOF</code>持久化文件名，默认文件名为<code>appendonly.aof</code></li><li>经验：建议配置为<code>appendonly-端口号.aof</code></li></ul></li><li>配置：<code>dir</code><ul><li>作用：<code>AOF</code>持久化文件保存路径</li><li>经验：与<code>RDB</code>持久化文件保持一致即可</li></ul></li></ul><h3 id="AOF重写"><a href="#AOF重写" class="headerlink" title="AOF重写"></a>AOF重写</h3><p>随着命令不断写入<code>AOF</code>，文件会越来越大，为了解决这个问题，Redis引入了<code>AOF</code>重写机制压缩文件体积。<code>AOF</code>文件重写是将Redis进程内的数据转化为些命令同步到新<code>AOF</code>文件的过程。简单说就是将对同一个数据的若干条命令执行结果转化成最终结果数据对应的指令进行记录。</p><h4 id="AOF重写作用"><a href="#AOF重写作用" class="headerlink" title="AOF重写作用"></a>AOF重写作用</h4><ul><li>降低磁盘占用量，提高磁盘利用率</li><li>提高持久化效率，降低持久化写时间，提升IO性能</li><li>降低数据恢复用时，提高数据恢复效率</li></ul><h4 id="AOF重写规则"><a href="#AOF重写规则" class="headerlink" title="AOF重写规则"></a>AOF重写规则</h4><ul><li>进程内已超时的数据不再写入文件</li><li>忽略无效指令，重写时使用进程内数据直接生成，这样新的AOF文件只保留最终数据的写入命令<ul><li>如：<code>del key1、hdel key2、srem key3、set key4 111、set key4 222</code></li></ul></li><li>对同一数据的多条写命令合并为同一条命令<ul><li>如：<code>push list1 a、lpush list1 b、lpush list1 c</code>可以转为：<code>lpush list1 a b c</code></li><li>为了防止数据量过大造成客户端缓冲区溢出，对<code>list</code>、<code>set</code>、<code>hash</code>、<code>zset</code>等类型，每条指令最多写入64个元素</li></ul></li></ul><h4 id="AOF重写方式"><a href="#AOF重写方式" class="headerlink" title="AOF重写方式"></a>AOF重写方式</h4><ul><li><p>手动重写：<code>bgrewriteaof</code></p></li><li><p>自动重写</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-min-size size  </span><br><span class="line">auto-aof-rewrite-percentage percentage  </span><br></pre></td></tr></table></figure></li></ul><h4 id="AOF自动重写方式"><a href="#AOF自动重写方式" class="headerlink" title="AOF自动重写方式"></a>AOF自动重写方式</h4><ul><li><p>自动重写触发条件设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-min-size size --自动AOF的重写尺寸(默认值比较大)  </span><br><span class="line">auto-aof-rewrite-percentage percent  --自动重写的百分比  </span><br></pre></td></tr></table></figure></li><li><p>自动重写触发对比参数（运行指令info persistence获取具体信息）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aof_current_size  </span><br><span class="line">aof_base_size  </span><br></pre></td></tr></table></figure></li><li><p>自动重写触发条件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aof_current_size &gt; auto_aof_rewrite_min_size  </span><br><span class="line">aof_current_size - aof_base_size / aof_base_size &gt;= auto-aof-rewrite-percentage  </span><br></pre></td></tr></table></figure><h4 id="AOF非重写流程"><a href="#AOF非重写流程" class="headerlink" title="AOF非重写流程"></a>AOF非重写流程</h4><p><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/redis/image.esj6iefr9.webp" alt="image.png"></p></li></ul><h4 id="AOF重写流程"><a href="#AOF重写流程" class="headerlink" title="AOF重写流程"></a>AOF重写流程</h4><p><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/redis/image.45horr3f9n.webp" alt="image.png"></p><h2 id="RDB与AOF区别"><a href="#RDB与AOF区别" class="headerlink" title="RDB与AOF区别"></a>RDB与AOF区别</h2><table><thead><tr><th>持久方式</th><th>RDB</th><th>AOF</th></tr></thead><tbody><tr><td>占用存储空间</td><td>小（数据级：压缩）</td><td>大（指令集：重写）</td></tr><tr><td>存储速度</td><td>慢</td><td>快</td></tr><tr><td>恢复速度</td><td>快</td><td>慢</td></tr><tr><td>数据安全性</td><td>会丢失数据</td><td>依据策略决定</td></tr><tr><td>消耗资源</td><td>高&#x2F;重量级</td><td>低&#x2F;轻量级</td></tr><tr><td>启动优先级</td><td>低</td><td>高</td></tr></tbody></table><h2 id="RDB与AOF怎么选"><a href="#RDB与AOF怎么选" class="headerlink" title="RDB与AOF怎么选"></a>RDB与AOF怎么选</h2><ul><li>对数据非常敏感，建议使用默认的<code>AOF</code>持久化方案<ul><li><code>AOF</code>持久化策略使用<code>everysecond</code>，每秒钟<code>fsync</code>一次。该策略redis仍然可以保持很好的性能，当出现问题时，最多丢失0-1秒钟的数据</li><li>注意：<code>AOF</code>文件存储体积较大，且恢复速度较慢</li></ul></li><li>数据呈现具有有效性，建议使用<code>RDB</code>持久化方案<ul><li>数据可以良好的做到阶段内无丢失（该阶段是开发者或运维人员手工维护的），且恢复速度快，阶段点数据恢复通常采用<code>RDB</code>方案</li><li>注意：利用<code>RDB</code>实现紧凑的数据持久化会使Redis性能降得很低</li></ul></li><li>综合比对<ul><li><code>RDB</code>与<code>AOF</code>的选择实际上是在做一种权衡，每种都有利弊</li><li>如不能承受数分钟以内的数据丢失，对业务数据非常敏感，选用<code>AOF</code></li><li>如能承受数分钟以内的数据丢失，且追求大数据的恢复速度，选用<code>RDB</code></li><li>灾难恢复选用<code>AOF</code></li><li>双保险策略，同时开启<code>RDB</code>和<code>AOF</code>，重启后，Redis优先使用<code>AOF</code>来恢复数据，降低丢失数据的量</li></ul></li></ul><h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>为什么要有事务：Redis执行指令过程中，多条连续执行的指令被干扰、打断、插队</p><p>Redis事务就是一个命令执行的队列，将一系列预定义命令包装成一个整体（一个队列）。当执行时，一次性按照添加顺序依次执行，中间不会被打断或干扰。</p><p>一个队伍中，一次性、顺序性、排他性的执行一系列命令</p><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><ul><li>开启事务：<code>multi</code><ul><li>作用：设定事务的开启位置，此指令执行后，后续的所有指令均加入到事务中</li></ul></li><li>执行事务：<code>exec</code><ul><li>作用：设定事务的结束位置，同时执行事务。与<code>multi</code>成对出现，成对使用</li></ul></li><li>取消事务：<code>discard</code><ul><li>作用：终止当前事务的定义，发生在<code>multi</code>之后，<code>exex</code>之前</li></ul></li></ul><p><strong>注意：加入事务的命令暂时进入到任务队列中，并没有立即执行，只有执行<code>exec</code>命令才开始执行</strong></p><h2 id="事务的工作流程"><a href="#事务的工作流程" class="headerlink" title="事务的工作流程"></a>事务的工作流程</h2><p><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/redis/image.1hs8heaien.webp" alt="image.png"></p><h2 id="事务的注意事项"><a href="#事务的注意事项" class="headerlink" title="事务的注意事项"></a>事务的注意事项</h2><ul><li>定义事务的过程中，命令格式输入错误怎么办？<ul><li>语法错误：指命令书写格式有误</li><li>处理结果：如果定义的事务中所包含存在语法错误，整体事务中所有命令均不会执行，包括那些语法正确的命令</li></ul></li><li>定义事务的过程中，命令执行出现错误怎么办？<ul><li>运行错误：指命令格式正确，但是无法正确的执行，例如对<code>list</code>进行<code>incr</code>操作</li><li>处理结果：能够正确运行的命令会执行，运行错误的命令不会执行</li></ul></li></ul><p><strong>注意：已经执行的命令对应的数据不会自动回滚，需要程序员自己在代码中实现回滚</strong></p><ul><li>手动进行事务回滚（无奈之举才用）<ul><li>记录操作过程中被影响的数据之前的状态<ul><li>单数据：<code>string</code></li><li>多数据：<code>hash</code>、<code>list</code>、<code>set</code>、<code>zset</code></li></ul></li><li>设置指令恢复所有的被修改的项<ul><li>单数据：直接<code>set</code>（注意周边属性，例如时效）</li><li>多数据：修改对应值或整体克隆复制</li></ul></li></ul></li></ul><h2 id="锁-–-基于特定条件的事务执行"><a href="#锁-–-基于特定条件的事务执行" class="headerlink" title="锁 – 基于特定条件的事务执行"></a>锁 – 基于特定条件的事务执行</h2><h3 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h3><h4 id="业务分析"><a href="#业务分析" class="headerlink" title="业务分析"></a>业务分析</h4><ul><li><p>多个客户端都有可能同时操作同一组数据，并且该数据一旦被操作修改后，将不适用于继续操作</p></li><li><p>在操作之前锁定要操作的数据，一旦发生变化，终止当前操作</p><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4></li><li><p>对<code>key</code>添加监视锁，在执行<code>exec</code>前如果<code>key</code>发生了变化，终止事务执行：<code>watch key1 [key2...]</code></p></li><li><p>取消对所有<code>key</code>的监视：<code>unwatch</code></p></li><li><p><code>watch</code>命令在事务开启之前，然后在执行事务的<code>exec</code>的时候，会判断<code>watch</code>的值是否已经发生变化，如果没有则正常事务执行，如果发生了变化，则操作<code>watch</code>的命令失败</p></li></ul><h3 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h3><h4 id="业务分析-1"><a href="#业务分析-1" class="headerlink" title="业务分析"></a>业务分析</h4><ul><li><p>使用<code>watch</code>监控一个<code>key</code>有没有改变已经不能解决问题，此处要监控的是具体数据</p></li><li><p>虽然Redis是单线程，但是多个客户对同一个数据同时进行操作时，如何避免不被同时修改</p><h4 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h4></li><li><p>设置<code>setnx</code>设置一个公共锁：<code>setnx lock-key value</code></p><ul><li>利用<code>setnx</code>命令的返回值特征，有值则返回设置失败，无值则返回设置成功</li><li>对于返回设置成功的，拥有控制权，进行下一步的具体业务操作</li><li>对于返回设置失败的，不具有控制权，排队或等待</li><li>操作完毕通过<code>del</code>操作释放锁</li></ul></li></ul><h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><h4 id="业务分析-2"><a href="#业务分析-2" class="headerlink" title="业务分析"></a>业务分析</h4><ul><li><p>由于锁操作由用户控制加锁解锁，必定会存在加所有未解锁的风险</p></li><li><p>需要解锁操作不能仅依赖用户控制，系统级别要能给出对应的保底处理方案</p><h4 id="解决方案-2"><a href="#解决方案-2" class="headerlink" title="解决方案"></a>解决方案</h4></li><li><p>使用<code>expire</code>为锁<code>key</code>添加时间限定，到时不释放锁，放弃锁</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expire lock-key second  </span><br><span class="line">pexpire lock-key milliseconds  </span><br></pre></td></tr></table></figure></li><li><p>由于操作通常都是微妙或毫秒级，因此该锁定时间不宜设置过长，具体时间需要业务测试后确定</p><ul><li>例如：持有锁的操作最长执行时间127ms，最短执行时间7ms</li><li>测试百万次最长执行时间对应命令的最大耗时，测试百万次网络延迟平均耗时</li><li>锁时间设定推荐：<code>最大耗时*120% + 平均网络延迟*100%</code></li><li>如果业务最大耗时&lt;&lt;网络平均耗时，通常为2个数量级，取其中单个耗时较长即可</li></ul></li></ul><h1 id="删除策略"><a href="#删除策略" class="headerlink" title="删除策略"></a>删除策略</h1><h2 id="Redis中的数据特征"><a href="#Redis中的数据特征" class="headerlink" title="Redis中的数据特征"></a>Redis中的数据特征</h2><ul><li>Redis是一种内存及数据库，所有数据均存放在内存中，内存中的数据可以通过<code>TTL</code>指令获取其状态<ul><li>XX：具有时效性的数据</li><li>-1：永久有效的数据</li><li>-2：已经过期的数据 或 被删除的数据 或 未定义的数据</li></ul></li></ul><p>数据删除策略的目的：在内存占用与CPU占用之间寻找一种平衡，顾此失彼都会造成整体Redis性能的下降，甚至引发服务器宕机或内存泄露</p><h2 id="定时删除"><a href="#定时删除" class="headerlink" title="定时删除"></a>定时删除</h2><p>创建一个定时器，当<code>key</code>设置由过期时间，且过期时间到达时，由定时器立即执行对键的删除操作</p><ul><li>优点：解决内存，到时就删除，快速释放掉不必要的内存占用</li><li>缺点：CPU压力很大，无论CPU此时负载量多高，均占用CPU，会影响Redis服务器响应时间和指令吞吐量</li><li>总结：用处理器性能换存储空间（拿时间换空间）</li></ul><h2 id="惰性删除"><a href="#惰性删除" class="headerlink" title="惰性删除"></a>惰性删除</h2><p>数据到达过期时间，不做处理，等下次访问该数据时再进行删除，并返回不存在</p><ul><li>优点：节约CPU性能，发现必须删除的时候才删除</li><li>缺点：内存压力很大，出现长期占用内存的数据</li><li>总结：用存储空间换取处理器性能（拿空间换时间）</li></ul><h2 id="定期删除"><a href="#定期删除" class="headerlink" title="定期删除"></a>定期删除</h2><ul><li><p>Redis启动服务器初始化时，读取配置server.hz的值，默认为10</p></li><li><p>每秒执行server.hz次<code>serverCron()-&gt;databaseCron()-&gt;activeExpireCycle()</code></p></li><li><p><code>activeExpireCycle()</code>对每个<code>expires[*]</code>逐一进行检测，每次执行250ms&#x2F;server.hz</p></li><li><p>对某个<code>expires[*]</code>检测时，随机挑选W个key检测</p><ul><li>如果key超时，删除key</li><li>如果一轮中删除的key的数量 &gt; W*25%，则循环该过程</li><li>如果一轮中删除的key的数量 &lt;&#x3D; W_25%，检查下一个`expires[_]`，db0-db15循环</li><li>W取值&#x3D;ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP属性值</li></ul></li><li><p>参数<code>current_db</code>用来记录<code>activeExpireCycle()</code>进入那个<code>expires[*]</code>执行</p></li><li><p>周期性轮询Redis库中的时效性数据，采用随机抽取的策略，利用过期数据占比的方式控制删除频度</p></li><li><p>特点1：CPU性能占用设置由峰值，检测频度可自定义设置</p></li><li><p>特点2：内存压力不是很大，长期占用内存的冷数据会被持续清理</p></li><li><p>总结：周期性抽查检查空间（随机抽查，重点抽查）</p></li></ul><h2 id="删除策略比对"><a href="#删除策略比对" class="headerlink" title="删除策略比对"></a>删除策略比对</h2><table><thead><tr><th>删除策略</th><th>特点1</th><th>特点2</th><th>总结</th></tr></thead><tbody><tr><td>定期删除</td><td>节约内存，无占用</td><td>部分时段占用CPU资源，频度高</td><td>拿时间换空间</td></tr><tr><td>惰性删除</td><td>内存占用严重</td><td>延时执行，CPU利用率高</td><td>拿空间换时间</td></tr><tr><td>定期删除</td><td>内存定期随机清理</td><td>每秒花费固定的CPU资源维护内存</td><td>随机抽查，重点抽查</td></tr></tbody></table><h2 id="逐出算法"><a href="#逐出算法" class="headerlink" title="逐出算法"></a>逐出算法</h2><h3 id="新数据进入检测"><a href="#新数据进入检测" class="headerlink" title="新数据进入检测"></a>新数据进入检测</h3><ul><li><p>当新数据进入Redis时，如果内存不足怎么办？</p><ul><li><p>Redis使用内存存储数据，在执行每一个命令前，会调用<code>freeMemoryIfNeeded()</code>检测内存是否充足，如果内存不满足新加入数据的最低存储要求，Redis要临时删除一些数据为当前指令清除存储空间。清理数据的策略称为<strong>逐出算法</strong></p></li><li><p>注意：逐出算法的过程不是100%能够清理出足够的可使用的内存空间，如果不成功则反复执行。当对所有数据尝试完毕后，如果不能达到内存清理的要求，将出现错误信息</p><h3 id="影响数据逐出的相关设置"><a href="#影响数据逐出的相关设置" class="headerlink" title="影响数据逐出的相关设置"></a>影响数据逐出的相关设置</h3></li></ul></li><li><p>最大可使用内存</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory  </span><br></pre></td></tr></table></figure><p>占用物理内存的比例，默认值为0，表示不限制。生产环境中根据需求设定，通常设置在50%以上。</p></li><li><p>每次选取待删除数据的个数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-samples  </span><br></pre></td></tr></table></figure><p>选取数据时并不会全库扫描，导致严重的性能消耗，降低读写性能。因此采用随机获取数据的方式作为待检测删除数据</p></li><li><p>删除策略</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-policy  </span><br></pre></td></tr></table></figure><p>达到最大内存后的，对被挑选出来的数据进行删除的策略</p></li><li><p>检测易失数据（可能会过期的数据集<code>server.db[i].expires</code>）</p><ol><li><code>volatile-lru</code>：挑选最近最少使用的数据淘汰（推荐）</li><li><code>volatile-lfu</code>：挑选最近使用次数最少的数据淘汰</li><li><code>volatile-ttl</code>：挑选将要过期的数据淘汰</li><li><code>volatile-random</code>：任意选择数据淘汰</li></ol></li><li><p>检测全库数据（所有数据集<code>server.db[i].dict</code>)</p><ol><li><code>allkeys-lru</code>：挑选最近最少使用的数据淘汰</li><li><code>allkeys-lfu</code>：挑选最近使用次数最少的数据淘汰</li><li><code>allkeys-random</code>：任意选择数据淘汰</li></ol></li><li><p>不使用数据驱逐</p><ul><li><code>no-enviction</code>(不驱逐)：禁止驱逐数据(redis4.0中默认策略)，会引发错误OOM(Out Of Memory)</li></ul></li><li><p>配置方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-policy volatile-lru  </span><br></pre></td></tr></table></figure><h3 id="数据逐出策略配置依据"><a href="#数据逐出策略配置依据" class="headerlink" title="数据逐出策略配置依据"></a>数据逐出策略配置依据</h3></li><li><p>使用<code>INFO</code>命令输出监控信息，查询缓存<code>hit</code>和<code>miss</code>的次数，根据业务需求调优Redis配置</p></li></ul><h1 id="Redis-Conf"><a href="#Redis-Conf" class="headerlink" title="Redis.Conf"></a>Redis.Conf</h1><h2 id="服务器基础配置"><a href="#服务器基础配置" class="headerlink" title="服务器基础配置"></a>服务器基础配置</h2><ul><li>设置服务器以守护进程的方式运行：<code>daemonize yes|no</code></li><li>绑定主机地址：<code>bind 127.0.0.1</code></li><li>设置服务器端口号：<code>port 6379</code></li><li>设置数据库数量：<code>databases 16</code></li></ul><h2 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h2><ul><li>设置服务器以指定日志记录级别：<code>loglevel debug|verbose|notice|warning</code></li><li>日志记录文件名：<code>logfile 端口号.log</code></li></ul><p><strong>注意：日志级别开发期设置为<code>verbose</code>，生产环境中配置为<code>notice</code>，简化日志输出量，降低写日志IO的频度</strong></p><h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><ul><li><p>设置同一时间最大客户端连接数，默认无限制。当客户端连接到达上限，Redis会关闭新的连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxclient 0  </span><br></pre></td></tr></table></figure></li><li><p>客户端限制等待最长时长，达到最大值后关闭连接，如需要关闭该功能，设置为0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">timeout</span> 300  </span><br></pre></td></tr></table></figure><h2 id="多服务器快捷配置"><a href="#多服务器快捷配置" class="headerlink" title="多服务器快捷配置"></a>多服务器快捷配置</h2></li><li><p>导入并加载指定配置文件信息，用于快速创建Redis公共配置较多的Redis实例配置文件，便于维护</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include /path/server-端口号.conf  </span><br></pre></td></tr></table></figure></li></ul><h1 id="高级数据类型"><a href="#高级数据类型" class="headerlink" title="高级数据类型"></a>高级数据类型</h1><h2 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h2><ul><li><p>获取指定key对应偏移量上的bit值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getbit key offset  </span><br></pre></td></tr></table></figure></li><li><p>设置指定key对应偏移量上的bit值，value只能时1或0</p><p>1</p><p>setbit key offset value</p></li><li><p>对指定key按位进行交、并、非、异或操作，并将结果保存到destKey中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bitop op destKey key1 \[key2...\]  </span><br><span class="line">// and：交  </span><br><span class="line">// or：并  </span><br><span class="line">// not：非  </span><br><span class="line">// xor：异或  </span><br></pre></td></tr></table></figure></li><li><p>统计指定key中1的数量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitcount key \[start end\]  </span><br></pre></td></tr></table></figure></li></ul><h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><ul><li><p>基数：数据集去重后元素个数</p></li><li><p>HyperLogLog是用来做基数统计的，运用了LogLog的算法</p></li><li><p>添加数据：<code>pfadd key element [element...]</code></p></li><li><p>统计数据：<code>pfcount key [key...]</code></p></li><li><p>合并数据：<code>pfmerge destKey sourceKey [sourceKey...]</code></p></li></ul><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul><li>只用于进行基数统计，不是集合，不保存数据，只记录数量而不是具体数量</li><li>核心是基数估计算法，最终数值存在一定误差</li><li>误差范围：基数估计的结果是一个带有0.81%标准错误的近似值</li><li>耗空间极小，每个hyperloglog key占用了12K的内存用于标记基数</li><li><code>pfadd</code>命令不是一次性分配12K内存使用，会随着基数的增加内存主键增大</li><li><code>pfmerge</code>命令合并后占用的存储空间为12K，无论合并之前数据量多大</li></ul><h2 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h2><ul><li><p>存放地理位置的数据类型</p><h3 id="基本操作-1"><a href="#基本操作-1" class="headerlink" title="基本操作"></a>基本操作</h3></li><li><p>添加坐标点：<code>geoadd key longitude latitude member [longitude latitude member...]</code></p></li><li><p>获取坐标点：<code>geopos key member [member...]</code></p></li><li><p>计算坐标点距离：<code>getdist key member1 member2 [unit]</code>(unit是单位，<code>m=米 km=千米</code>)</p></li><li><p>根据坐标求范围内的数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">georadius key longitude latitude redius m|km|ft|mi \[withcoord\] \[withdist\] \[withhash\] \[count count\]  </span><br></pre></td></tr></table></figure></li><li><p>根据点求范围内的数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">georadiusbymember key member radius m|km|ft|mi \[withcoord\] \[withdist\] \[withhash\] \[count count\]  </span><br></pre></td></tr></table></figure></li><li><p>获取指定点对应的坐标hash值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geohash key member \[member...\]</span><br></pre></td></tr></table></figure></li></ul></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/commonlyUsed/avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/commonlyUsed/avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Fantasy-ke</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.fantasyke.cn/posts/505826b8.html">原创</a><a class="post-copyright-title"><span onclick='rm.copyPageUrl("https://blog.fantasyke.cn/posts/505826b8.html")'>Redis进阶</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://picx.fantasyke.cn/qrcode/qrcode-weichat.jpg" target="_blank"><img class="post-qr-code-img" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/qrcode/qrcode-weichat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://picx.fantasyke.cn/qrcode/qrcode-alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/qrcode/qrcode-alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.fantasyke.cn/posts/505826b8.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Redis进阶&amp;url=https://blog.fantasyke.cn/posts/505826b8.html&amp;pic=https://picx.fantasyke.cn/wallpaper/4d5b121d880511ebb6edd017c2d2eca2.2ks0d4tx06.webp?_r_=e45edc1b-00c8-2dd9-a483-cc199172f011" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.fantasyke.cn" target="_blank">Fantasy`Ke Blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Redis/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span> Redis<span class="tagsPageCount">4</span></a><a class="post-meta__box__tags" href="/tags/NOSQL/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span> NOSQL<span class="tagsPageCount">4</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/fantasy-ke/picx-images-hosting/master/notion/a1cb98277a184ae4e927e36e72b75d2c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/fe29e710.html"><img class="prev-cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/45663c9f2ce54eb2ae8628efb0c43390.8vn0b0iqtf.webp?_r_=56506372-a5e5-413e-a6dc-e85f1f9fec76" onerror='onerror=null,src="/img/friend_404.gif"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Redis基础</div></div></a></div><div class="next-post pull-right"><a href="/posts/37cf2cfd.html"><img class="next-cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/748a31364d194d419020419f204265f0.6wqtgcnicr.webp?_r_=b8632a9e-867a-fdd5-3e61-b6f43be91b64" onerror='onerror=null,src="/img/friend_404.gif"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Redis集群</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/fe29e710.html" title="Redis基础"><img class="cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/45663c9f2ce54eb2ae8628efb0c43390.8vn0b0iqtf.webp?_r_=56506372-a5e5-413e-a6dc-e85f1f9fec76" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-05-29</div><div class="title">Redis基础</div></div></a></div><div><a href="/posts/37cf2cfd.html" title="Redis集群"><img class="cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/748a31364d194d419020419f204265f0.6wqtgcnicr.webp?_r_=b8632a9e-867a-fdd5-3e61-b6f43be91b64" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-06-01</div><div class="title">Redis集群</div></div></a></div><div><a href="/posts/7f6af2c0.html" title="Redis企业级解决方案"><img class="cover" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/3de7c790881611ebb6edd017c2d2eca2.7ax9bjljc0.webp?_r_=92295f11-a516-128f-1b1a-e2c9c32a0fdc" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-06-02</div><div class="title">Redis企业级解决方案</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i> <span>评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NET-Core%E6%93%8D%E4%BD%9CRedis"><span class="toc-number">1.</span> <span class="toc-text">.NET Core操作Redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E8%BF%87%E7%A8%8B%E4%BF%9D%E5%AD%98%E4%BB%80%E4%B9%88"><span class="toc-number">2.1.</span> <span class="toc-text">持久化过程保存什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDB"><span class="toc-number">2.2.</span> <span class="toc-text">RDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">RDB持久化的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">注意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bgsave"><span class="toc-number">2.2.3.</span> <span class="toc-text">bgsave</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8CRDB"><span class="toc-number">2.2.4.</span> <span class="toc-text">自动执行RDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8CRDB%E6%B3%A8%E6%84%8F"><span class="toc-number">2.2.5.</span> <span class="toc-text">自动执行RDB注意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="toc-number">2.2.6.</span> <span class="toc-text">三种方案对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%E7%89%B9%E6%AE%8A%E5%90%AF%E5%8A%A8%E5%BD%A2%E5%BC%8F"><span class="toc-number">2.2.7.</span> <span class="toc-text">RDB特殊启动形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%E4%BC%98%E7%82%B9"><span class="toc-number">2.2.8.</span> <span class="toc-text">RDB优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%E7%BC%BA%E7%82%B9"><span class="toc-number">2.2.9.</span> <span class="toc-text">RDB缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOF"><span class="toc-number">2.3.</span> <span class="toc-text">AOF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%E5%AD%98%E5%82%A8%E7%9A%84%E5%BC%8A%E7%AB%AF"><span class="toc-number">2.3.1.</span> <span class="toc-text">RDB存储的弊端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF"><span class="toc-number">2.3.2.</span> <span class="toc-text">解决思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">2.3.3.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E5%86%99%E6%95%B0%E6%8D%AE%E4%B8%89%E7%A7%8D%E7%AD%96%E7%95%A5-appendfsync"><span class="toc-number">2.3.4.</span> <span class="toc-text">AOF写数据三种策略(appendfsync)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.5.</span> <span class="toc-text">AOF配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99"><span class="toc-number">2.3.6.</span> <span class="toc-text">AOF重写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99%E4%BD%9C%E7%94%A8"><span class="toc-number">2.3.6.1.</span> <span class="toc-text">AOF重写作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99"><span class="toc-number">2.3.6.2.</span> <span class="toc-text">AOF重写规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.6.3.</span> <span class="toc-text">AOF重写方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E8%87%AA%E5%8A%A8%E9%87%8D%E5%86%99%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.6.4.</span> <span class="toc-text">AOF自动重写方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E9%9D%9E%E9%87%8D%E5%86%99%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.6.5.</span> <span class="toc-text">AOF非重写流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.6.6.</span> <span class="toc-text">AOF重写流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDB%E4%B8%8EAOF%E5%8C%BA%E5%88%AB"><span class="toc-number">2.4.</span> <span class="toc-text">RDB与AOF区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDB%E4%B8%8EAOF%E6%80%8E%E4%B9%88%E9%80%89"><span class="toc-number">2.5.</span> <span class="toc-text">RDB与AOF怎么选</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">3.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">3.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.</span> <span class="toc-text">基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">3.3.</span> <span class="toc-text">事务的工作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.4.</span> <span class="toc-text">事务的注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81-%E2%80%93-%E5%9F%BA%E4%BA%8E%E7%89%B9%E5%AE%9A%E6%9D%A1%E4%BB%B6%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C"><span class="toc-number">3.5.</span> <span class="toc-text">锁 – 基于特定条件的事务执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">3.5.1.</span> <span class="toc-text">乐观锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90"><span class="toc-number">3.5.1.1.</span> <span class="toc-text">业务分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">3.5.1.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">3.5.2.</span> <span class="toc-text">分布式锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90-1"><span class="toc-number">3.5.2.1.</span> <span class="toc-text">业务分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1"><span class="toc-number">3.5.2.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E9%94%81"><span class="toc-number">3.5.3.</span> <span class="toc-text">死锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90-2"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">业务分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-2"><span class="toc-number">3.5.3.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5"><span class="toc-number">4.</span> <span class="toc-text">删除策略</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%89%B9%E5%BE%81"><span class="toc-number">4.1.</span> <span class="toc-text">Redis中的数据特征</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E5%88%A0%E9%99%A4"><span class="toc-number">4.2.</span> <span class="toc-text">定时删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%83%B0%E6%80%A7%E5%88%A0%E9%99%A4"><span class="toc-number">4.3.</span> <span class="toc-text">惰性删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E6%9C%9F%E5%88%A0%E9%99%A4"><span class="toc-number">4.4.</span> <span class="toc-text">定期删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5%E6%AF%94%E5%AF%B9"><span class="toc-number">4.5.</span> <span class="toc-text">删除策略比对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%90%E5%87%BA%E7%AE%97%E6%B3%95"><span class="toc-number">4.6.</span> <span class="toc-text">逐出算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E6%95%B0%E6%8D%AE%E8%BF%9B%E5%85%A5%E6%A3%80%E6%B5%8B"><span class="toc-number">4.6.1.</span> <span class="toc-text">新数据进入检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E6%95%B0%E6%8D%AE%E9%80%90%E5%87%BA%E7%9A%84%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE"><span class="toc-number">4.6.2.</span> <span class="toc-text">影响数据逐出的相关设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%90%E5%87%BA%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE%E4%BE%9D%E6%8D%AE"><span class="toc-number">4.6.3.</span> <span class="toc-text">数据逐出策略配置依据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-Conf"><span class="toc-number">5.</span> <span class="toc-text">Redis.Conf</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">服务器基础配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.</span> <span class="toc-text">日志配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-number">5.3.</span> <span class="toc-text">客户端配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BF%AB%E6%8D%B7%E9%85%8D%E7%BD%AE"><span class="toc-number">5.4.</span> <span class="toc-text">多服务器快捷配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">高级数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Bitmaps"><span class="toc-number">6.1.</span> <span class="toc-text">Bitmaps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HyperLogLog"><span class="toc-number">6.2.</span> <span class="toc-text">HyperLogLog</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">6.2.1.</span> <span class="toc-text">说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GEO"><span class="toc-number">6.3.</span> <span class="toc-text">GEO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-1"><span class="toc-number">6.3.1.</span> <span class="toc-text">基本操作</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget" id="card-poem"><div id="poem_sentence"></div><div id="poem_info"><div id="poem_dynasty"></div><div id="poem_author"></div></div></div><script src="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/jinrishici.js" charset="utf-8"></script><script>jinrishici.load((function(e){var n=document.querySelector("#poem_sentence"),t=document.querySelector("#poem_author"),o=document.querySelector("#poem_dynasty"),r=e.data.content;r=r.substr(0,r.length-1),n.innerHTML=r,o.innerHTML=e.data.origin.dynasty,t.innerHTML=e.data.origin.author+"《"+e.data.origin.title+"》"}))</script><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/a65df701.html" title="Notion + Hexo + GitHub Actions + Vercel 博客解决方案"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://raw.githubusercontent.com/fantasy-ke/picx-images-hosting/master/notion/a1cb98277a184ae4e927e36e72b75d2c.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="Notion + Hexo + GitHub Actions + Vercel 博客解决方案"></a><div class="content"><a class="title" href="/posts/a65df701.html" title="Notion + Hexo + GitHub Actions + Vercel 博客解决方案">Notion + Hexo + GitHub Actions + Vercel 博客解决方案</a><time datetime="2025-02-13T10:52:00.000Z" title="发表于 2025-02-13 10:52:00">2025-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cfaae164.html" title="Notion-Hexo 的 Elog 配置详解"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://raw.githubusercontent.com/fantasy-ke/picx-images-hosting/master/notion/de91d8193c1b7d27e88f220af42a71b8.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="Notion-Hexo 的 Elog 配置详解"></a><div class="content"><a class="title" href="/posts/cfaae164.html" title="Notion-Hexo 的 Elog 配置详解">Notion-Hexo 的 Elog 配置详解</a><time datetime="2025-02-13T10:52:00.000Z" title="发表于 2025-02-13 10:52:00">2025-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6077dc15.html" title="在.NET Core中使用异步多线程消费"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/3de7c790881611ebb6edd017c2d2eca2.7ax9bjljc0.webp?_r_=56129e5c-dbf5-13e4-0c21-610a2222685c" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="在.NET Core中使用异步多线程消费"></a><div class="content"><a class="title" href="/posts/6077dc15.html" title="在.NET Core中使用异步多线程消费">在.NET Core中使用异步多线程消费</a><time datetime="2024-12-24T09:40:02.000Z" title="发表于 2024-12-24 09:40:02">2024-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a2b0f015.html" title="C#8.0 可空引用类型"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/45663c9f2ce54eb2ae8628efb0c43390.8vn0b0iqtf.webp?_r_=25794239-f69c-186d-635e-9fb09a74d154" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="C#8.0 可空引用类型"></a><div class="content"><a class="title" href="/posts/a2b0f015.html" title="C#8.0 可空引用类型">C#8.0 可空引用类型</a><time datetime="2024-12-17T09:40:02.000Z" title="发表于 2024-12-17 09:40:02">2024-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/72bea106.html" title="Hexo nexT主题添加相册"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/16e97308c2e942a28c68afb22a36023b.4g4l5r6ckp.webp?_r_=949f37a7-335b-07d4-6d64-38040a0a0a11" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="Hexo nexT主题添加相册"></a><div class="content"><a class="title" href="/posts/72bea106.html" title="Hexo nexT主题添加相册">Hexo nexT主题添加相册</a><time datetime="2024-11-29T08:17:18.076Z" title="发表于 2024-11-29 08:17:18">2024-11-29</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:contact@fantasyke.cn" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2246080525&amp;site=qq&amp;menu=yes" title="QQ"><i class="anzhiyufont anzhiyu-icon-qq"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="/static/images/footer.gif" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/fantasy-ke" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.youtube.com/@%E5%91%A8%E6%A2%A6-z9i" title="YouTube"><i class="fab fa-youtube"></i></a></div><div id="workboard"><img class="workSituationImg boardsign" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/blogOther/shangban.2obnt8s19a.svg" alt="距离月入20k也就还差一个大佬带我~" title="距离月入20k也就还差一个大佬带我~"><div id="runtimeTextTip"></div></div><div class="footer_custom_text"><a href="https://blogscn.fun/" title="BLOGS·CN" target="_blank"><img src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://photo.xiangming.site/img/blogscn.png" alt="本站已加入BLOGS·CN" style="width:auto;height:15px"></a><a href="https://www.blogsclub.org/go" target="_blank" title="空间穿梭-随机访问BlogsClub成员博客"><img style="width:auto;height:22px" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://www.blogsclub.org/images/shuttle_3.png"></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="今日热榜" target="_blank" rel="noopener" href="https://hot.fantasyke.cn/">今日热榜</a><a class="footer-item" title="站点状态" target="_blank" rel="noopener" href="https://status.fantasyke.cn/">站点状态</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/policy/">隐私协议</a><a class="footer-item" title="版权协议" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2025 By <a class="footer-bar-link" href="/" title="Fantasy-ke" target="_blank">Fantasy-ke</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType(){fetch("https://v1.hitokoto.cn").then((t=>t.json())).then((t=>{{const e="出自 "+t.from,p=["既然选择远方，当不负青春，砥砺前行。","青春由磨砺而出彩，人生因奋斗而升华！","但行前路，不负韶华！","每一个裂缝都是为透出光而努力","美好的一天，上帝不会就这样给你，需要自己去创造。","你要做冲出的黑马 而不是坠落的星星。","纵然世间黑暗，仍有一点星光。","试一下，你会比你自己想象中的还要强大","眼里有不朽的光芒 心里有永恒的希望","等待的不仅仅是未来，还有希望…"];p.unshift(t.hitokoto,e),window.typed=new Typed("#footer-type-tips",{strings:p,startDelay:300,typeSpeed:150,loop:!0,backSpeed:50})}}))}"function"==typeof Typed?subtitleType():getScript("https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js").then(subtitleType)</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://fantasyke.cn" title="主页">主页</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="湘ICP无备-0000001号">湘ICP无备-0000001号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">40</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">11</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://fantasyke.cn/" title="主页"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="主页"><span class="back-menu-item-text">主页</span></a><a class="back-menu-item" href="https://blog.fantasyke.cn/" title="博客"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://imgbed.fantasyke.cn/" title="图床"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="图床"><span class="back-menu-item-text">图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://hot.fantasyke.cn/" title="今日热榜"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="今日热榜"><span class="back-menu-item-text">今日热榜</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://music.fantasyke.cn/" title="音乐"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="音乐"><span class="back-menu-item-text">音乐</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://status.fantasyke.cn/" title="站点状态"><img class="back-menu-item-icon" src="/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/logo/favicon.ico" alt="站点状态"><span class="back-menu-item-text">站点状态</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i> <span>时光卷轴</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i> <span>文章分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i> <span>文章标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa-solid fa-chart-pie faa-tada"></i> <span>文章通览</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>社交</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i> <span>友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i> <span>留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa-solid fa-comments faa-tada faa-tada"></i> <span>评论</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i> <span>音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i> <span>碎碎念</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/sitenav/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i> <span>网站</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i> <span>关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/policy/"><i class="fa-solid fa-copyright faa-tada faa-tada"></i> <span>隐私策</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.fantasyke.cn"><i class="fa-solid fa-chart-simple faa-tada"></i> <span>站点统计</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"><a class="tag-list" href="/tags/Docker" title="Docker">Docker</a><a class="tag-list" href="/tags/ASP.NET%20Core" title="ASP.NET Core">ASP.NET Core</a><a class="tag-list" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="设计模式">设计模式</a><a class="tag-list" href="/tags/CQRS" title="CQRS">CQRS</a></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script async>!function(){var e,t,n,r,a,o=new Date("04/01/2022 00:00:00"),i=new Date;setInterval((()=>{!function(){i=new Date,a=i.getHours();var l=(i-o)/1e3/60/60/24;e=Math.floor(l);var u=(i-o)/1e3/60/60-24*e;t=Math.floor(u),1==String(t).length&&(t="0"+t);var g=(i-o)/1e3/60-1440*e-60*t;n=Math.floor(g),1==String(n).length&&(n="0"+n);var d=(i-o)/1e3-86400*e-3600*t-60*n;r=Math.round(d),1==String(r).length&&(r="0"+r)}(),function(){if(!document.getElementById("footer"))return;let o="";if(a<18&&a>=9)o=`本站居然运行了 ${e} 天<span id='runtime'> ${t} 小时 ${n} 分 ${r} 秒 </span>`;else{let a=document.querySelector("#workboard .workSituationImg");null!=a&&(a.src="https://picx.fantasyke.cn/blogOther/xiaban.2a582djqe6.svg",a.title="下班了就该开开心心的玩耍，嘿嘿~",a.alt="下班了就该开开心心的玩耍，嘿嘿~"),o=`本站居然运行了 ${e} 天<span id='runtime'> ${t} 小时 ${n} 分 ${r} 秒 </span>`}document.getElementById("runtimeTextTip")&&(document.getElementById("runtimeTextTip").innerHTML=o)}()}),1e3)}()</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(()=>{const t=()=>{"object"==typeof twikoo?setTimeout(o,0):getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(o)},o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.fantasyke.cn",region:"",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))};t()})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener("load",(()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++){t+="<div class='aside-list-item'>";{const a="data-lazy-src";t+=`<a href='${e[n].url}' class='thumbnail'><img ${a}='${e[n].avatar}' alt='${e[n].nick}'><div class='name'><span>${e[n].nick} </span></div></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <time datetime="${e[n].date}">${anzhiyu.diffDate(e[n].date,!0)}</time></div>\n        </div>`}else t+="没有评论";let n=document.querySelector("#card-newest-comments .aside-list");n&&(n.innerHTML=t),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("twikoo-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{twikoo.getRecentComments({envId:"https://twikoo.fantasyke.cn",region:"",pageSize:6,includeReply:!0}).then((function(t){const n=t.map((e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()};var t}));saveToLocal.set("twikoo-newest-comments",JSON.stringify(n),10/1440),e(n)})).catch((function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"}))};"object"==typeof twikoo?t():getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)}))</script><script>var visitorMail="demo@fantasyke.cn"</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://lib.baomitu.com/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="/static/js/card-welcome.js"></script><script src="/static/js/countdown.js"></script><script src="/static/js/footer-animal.js"></script><script src="/static/js/comments.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!0,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","G-5N1WS0B6FJ",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%;margin-bottom: 15px;"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp" alt="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-12-24</span><a class="blog-slider__title" href="posts/6077dc15.html">在.NET Core中使用异步多线程消费</a><div class="blog-slider__text">处理大量数据是一个常见的需求，传统的同步处理方式往往效率低下，尤其是在数据量非常大的情况下。</div><a class="blog-slider__button" href="posts/6077dc15.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp" alt="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-26</span><a class="blog-slider__title" href="posts/fa354dcb.html">MediatR：轻松实现命令查询职责分离模式(CQRS)</a><div class="blog-slider__text"><li><a href="#一对一">一对一</a></li></div><a class="blog-slider__button" href="posts/fa354dcb.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp" alt="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-28</span><a class="blog-slider__title" href="posts/896e333f.html">gRPC in ASP.NET Core</a><div class="blog-slider__text"><li><a href="#消息类型的演进">消息类型的演进</a></li></div><a class="blog-slider__button" href="posts/896e333f.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp" alt="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-07-08</span><a class="blog-slider__title" href="posts/6c86af72.html">.NET Core使用Cap</a><div class="blog-slider__text"><li><a href="#准备工作">准备工作</a></li></div><a class="blog-slider__button" href="posts/6c86af72.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/%E5%9B%BE%E7%89%87%E6%8C%82%E4%BA%86" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" data-lazy-src="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp" alt="https://picx.fantasyke.cn/wallpaper/1.10297vainl.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-10-11</span><a class="blog-slider__title" href="posts/e5c315n.html">.NET Core中RabbitMQ初识</a><div class="blog-slider__text">前段时间上班无事，上网冲浪看到了消息队列RabbitMQ，就想着学习一下，网上看了点资料在哔哩哔哩上看的到codeman讲的一个rabbitmq的视频，就跟着仔细学习一下，敲一下</div><a class="blog-slider__button" href="posts/e5c315n.html">详情</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("已挂载swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"left",width:200,height:400},mobile:{show:!0},react:{opacity:.7},alg:"crc32",rep:"hex",drafts:!1,auto_category:{enable:!0,depth:null,over_write:!1},auto_title:!1,auto_date:!1,force:!1,log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html>